import{a as e,u as t}from"./EyeInvisibleOutlined-BEfU4b7H.js";import{n,t as r}from"./_plugin-vue_export-helper-B7nIStOx.js";import{a as i,i as ee,l as a,o,t as s}from"./input-B6Z8fLJr.js";import{i as c,t as te}from"./table-CHoPGXGQ.js";import{r as ne,t as re}from"./select-BTuKSqOm.js";import{o as ie}from"./Col-DyoQw_cT.js";import"./FolderOutlined-CViWk2Kw.js";import{t as l}from"./modal-LfS8E54v.js";import"./checkbox-B_sO6a1e.js";import"./dropdown-CwrvQ9kw.js";import"./dayjs-eyFkofVj.js";import"./SwapRightOutlined-EgwF5-lN.js";import{t as ae}from"./date-picker-BpzsXXGI.js";import"./es-DwX9Y9BE.js";import"./UpOutlined-CvRWPLjE.js";import"./spin-BgwR0sk-.js";import"./ArrowRightOutlined-C62FZmmk.js";import{Dn as u,En as d,Nn as f,Rn as p,Sn as m,Tn as h,Un as oe,Vn as g,Wn as se,Xn as _,bn as v,cr as y,dr as b,gn as x,kn as S,l as C,mn as w,nr as T,ur as ce,wn as E,xn as D}from"./index-PEy_QorE.js";import{t as le}from"./Icon-CtOaZygp.js";import{a as O,i as k,r as A,t as j}from"./dateUtil-htTZqwgG.js";import{t as M}from"./pricingVersion-CxXyvqkr.js";const N=[{title:`No`,dataIndex:`index`,key:`index`,width:80},{title:`Pricing Version Id`,dataIndex:`pricingVersionId`,key:`pricingVersionId`,width:240,sorter:!0,sortDirections:[`ascend`,`descend`]},{title:`Effective From`,dataIndex:`effectiveFrom`,key:`effectiveFrom`,width:180,customRender:({text:e})=>S(`span`,e?j(k(e)):`-`)},{title:`Effective To`,dataIndex:`effectiveTo`,key:`effectiveTo`,width:180,customRender:({text:e})=>S(`span`,e?j(k(e)):`-`)},{title:`Status`,dataIndex:`status`,key:`status`,width:120},{title:`Action`,key:`action`,fixed:`right`,width:80}];var ue={class:`pricing-version-page`},de={class:`title`},P={style:{display:`flex`,gap:`12px`,"align-items":`center`,"margin-bottom":`8px`}},F={key:0},I=[`onClick`,`type`],L={key:1},R=r(u({__name:`index`,props:{planId:{}},setup(r){let u=r.planId??``,S=T(``),k=T(!1),j=T(!1),R=T(!1),z=T(!1),B=T(null),V=T(1),H=T(20),U=T(0),W=T([]),G=T([]),K={pricingVersionId:``,effectiveFrom:void 0,effectiveTo:void 0,status:`DRAFT`},q=T({...K}),J=T(),fe=N,pe=v(()=>({current:V.value,pageSize:H.value,total:U.value,showSizeChanger:!0,showQuickJumper:!0})),me=e=>e.pricingVersionId,he=v(()=>W.value.map((e,t)=>({...e,index:(V.value-1)*H.value+t+1,__onEdit:X,__onDelete:Z,__onView:Q}))),ge=v(()=>({selectedRowKeys:G.value,onChange:e=>{G.value=e.slice()}})),_e={pricingVersionId:[{required:!0,message:`PricingVersionId required`,trigger:`blur`}],effectiveFrom:[{type:`object`,required:!0,message:`EffectiveFrom required`,trigger:`change`}],effectiveTo:[{type:`object`,required:!1,message:`EffectiveTo required`,trigger:`change`}]},Y=async()=>{k.value=!0;try{let e=await M.getAll(u);W.value=e.data??e??[],U.value=W.value.length}catch(e){console.error(e),C.error(`Load pricing versions failed`)}finally{k.value=!1}},ve=()=>{V.value=1,Y()},ye=e=>{e&&(V.value=e.current||V.value,H.value=e.pageSize||H.value),Y()},be=async()=>{z.value=!1,B.value=null,Object.assign(q.value,a(K)),R.value=!0,await f(),J.value?.resetFields?.(a(K)),J.value?.clearValidate?.(),await f()};async function X(e){z.value=!0,B.value=e.pricingVersionId;try{let t=await M.getDetail(u,e.pricingVersionId),n=t.data??t;Object.assign(q.value,{pricingVersionId:n.pricingVersionId,effectiveFrom:n.effectiveFrom?A(n.effectiveFrom):void 0,effectiveTo:n.effectiveTo?A(n.effectiveTo):void 0,status:n.status??`DRAFT`}),R.value=!0,await f(),J.value?.clearValidate()}catch(e){console.error(e),C.error(`Load pricing version detail failed`)}}async function Z(e){l.confirm({title:`Delete pricing version`,content:`Delete version ${e.pricingVersionId}?`,onOk:async()=>{try{await M.remove(u,e.pricingVersionId),C.success(`Deleted`),G.value=G.value.filter(t=>t!==e.pricingVersionId),Y()}catch(e){console.error(e),C.error(`Delete failed`)}}})}function Q(e){C.info(`View ${e.pricingVersionId}`)}let xe=async()=>{G.value.length&&l.confirm({title:`Delete ${G.value.length} version(s)`,content:`Are you sure to delete selected versions?`,onOk:async()=>{try{for(let e of[...G.value])await M.remove(u,e);C.success(`Deleted selected versions`),G.value=[],V.value=1,Y()}catch(e){console.error(e),C.error(`Delete failed`)}}})},Se=async()=>{try{await J.value?.validate?.()}catch{return}let e={pricingVersionId:(q.value.pricingVersionId??``).trim(),effectiveFrom:O(q.value.effectiveFrom),effectiveTo:q.value.effectiveTo?O(q.value.effectiveTo):null,createdBy:void 0},t={effectiveFrom:O(q.value.effectiveFrom),effectiveTo:q.value.effectiveTo?O(q.value.effectiveTo):null,status:q.value.status??`DRAFT`};j.value=!0;try{z.value&&B.value?(await M.update(u,B.value,t),C.success(`Updated`)):(await M.create(u,e),C.success(`Created`)),R.value=!1,G.value=[],Y()}catch(e){console.error(e),C.error(String(e?.response?.data?.message??`Save failed`))}finally{j.value=!1}},Ce=()=>{R.value=!1};p(async()=>{await Y()});function we(e){return e.key===`edit`?`EditOutlined`:e.key===`delete`?`DeleteOutlined`:e.key===`planVersion`?`ProfileOutlined`:e.key===`pricingVersion`?`DatabaseOutlined`:`AppstoreOutlined`}function Te(e,t){return typeof e.label==`function`?e.label(t):e.label}function Ee(e){return[{key:`edit`,label:`Edit`,type:`default`,permission:!0,enable:!0,onClick:X},{key:`delete`,label:`Delete`,type:`danger`,permission:!0,enable:!0,onClick:Z},{key:`view`,label:`View`,type:`default`,permission:!0,enable:!0,onClick:Q}]}function De(e,t){try{e.domEvent?.stopPropagation?.();let n=e.key;if(n===`edit`)return $(t,`__onEdit`);if(n===`delete`)return $(t,`__onDelete`);if(n===`view`)return $(t,`__onView`)}catch(e){console.error(`onMenuClickWithRecord error`,e),C.error(`Action failed`)}}function $(e,t){try{let n=e?.[t];if(typeof n==`function`)return n(e);console.warn(`${t} is not a function on record`,e)}catch(e){console.error(`safeCall error`,e)}}return(r,a)=>{let f=ee,p=n,v=le,C=t,T=e,O=c,A=te,M=ie,N=s,B=o,V=ae,H=re,U=ne,W=i,K=l,X=se(`router-view`);return g(),m(X,null,{default:_(({route:e})=>[D(`div`,ue,[D(`h2`,de,`Pricing Versions for `+b(y(u)),1),d(M,{class:`mb16`,"body-style":{padding:`12px`}},{default:_(()=>[D(`div`,P,[d(f,{value:S.value,"onUpdate:value":a[0]||=e=>S.value=e,placeholder:`Search by PricingVersionId`,onSearch:ve,style:{width:`360px`},allowClear:``},null,8,[`value`]),d(p,{type:`primary`,onClick:be},{default:_(()=>[...a[8]||=[h(`Create Pricing Version`,-1)]]),_:1}),d(p,{danger:``,disabled:!G.value.length,onClick:xe},{default:_(()=>[...a[9]||=[h(`Delete Selected`,-1)]]),_:1},8,[`disabled`]),d(p,{loading:k.value,onClick:Y},{default:_(()=>[...a[10]||=[h(`Refresh`,-1)]]),_:1},8,[`loading`])]),d(A,{columns:y(fe),dataSource:he.value,loading:k.value,pagination:pe.value,rowKey:me,rowSelection:ge.value,scroll:{x:1e3},onChange:ye},{bodyCell:_(({column:e,record:t})=>[e.key===`action`?(g(),m(O,{key:0,placement:`topLeft`,trigger:`click`},{overlay:_(()=>[d(T,{class:`menu-box`,onClick:a[1]||=()=>De},{default:_(()=>[(g(!0),E(x,null,oe(Ee(t),(e,n)=>(g(),m(C,{key:`${n}-${e.label}`,style:ce({color:e.type===`delete`?`red`:`inherit`})},{icon:_(()=>[d(v,{align:`2px`,size:`15px`,style:{"margin-right":`12px`},type:we(e)},null,8,[`type`])]),default:_(()=>[e.permission===!1?(g(),E(`span`,F,`——`)):(g(),E(`a`,{key:1,onClick:()=>e.onClick?.(t),type:e.type},b(Te(e,t)),9,I))]),_:2},1032,[`style`]))),128))]),_:2},1024)]),default:_(()=>[D(`span`,{class:`ant-dropdown-link`,role:`button`,tabindex:`0`,onClick:a[2]||=w(()=>{},[`prevent`])},[d(v,{align:`2px`,size:`20px`,style:{"margin-left":`5px`},type:`EllipsisOutlined`})])]),_:2},1024)):(g(),E(`span`,L,b(t[e.dataIndex]),1))]),_:1},8,[`columns`,`dataSource`,`loading`,`pagination`,`rowSelection`])]),_:1}),d(K,{open:R.value,"onUpdate:open":a[7]||=e=>R.value=e,title:z.value?`Edit Pricing Version`:`Create Pricing Version`,onOk:Se,onCancel:Ce,confirmLoading:j.value,width:640,centered:``},{default:_(()=>[d(W,{ref_key:`formRef`,ref:J,model:q.value,rules:_e,layout:`vertical`},{default:_(()=>[d(B,{label:`Pricing Version Id`,name:`pricingVersionId`,rules:z.value?[]:[{required:!0,message:`PricingVersionId required`}]},{default:_(()=>[d(N,{value:q.value.pricingVersionId,"onUpdate:value":a[3]||=e=>q.value.pricingVersionId=e,disabled:z.value,placeholder:`e.g. PRC_2025_09`},null,8,[`value`,`disabled`])]),_:1},8,[`rules`]),d(B,{label:`Effective From`,name:`effectiveFrom`,rules:[{required:!0,message:`EffectiveFrom required`}]},{default:_(()=>[d(V,{value:q.value.effectiveFrom,"onUpdate:value":a[4]||=e=>q.value.effectiveFrom=e,style:{width:`100%`}},null,8,[`value`])]),_:1}),d(B,{label:`Effective To`,name:`effectiveTo`},{default:_(()=>[d(V,{value:q.value.effectiveTo,"onUpdate:value":a[5]||=e=>q.value.effectiveTo=e,style:{width:`100%`}},null,8,[`value`])]),_:1}),d(B,{label:`Status`,name:`status`},{default:_(()=>[d(U,{value:q.value.status,"onUpdate:value":a[6]||=e=>q.value.status=e,placeholder:`Select status`},{default:_(()=>[d(H,{value:`DRAFT`},{default:_(()=>[...a[11]||=[h(`DRAFT`,-1)]]),_:1}),d(H,{value:`REVIEW`},{default:_(()=>[...a[12]||=[h(`REVIEW`,-1)]]),_:1}),d(H,{value:`APPROVED`},{default:_(()=>[...a[13]||=[h(`APPROVED`,-1)]]),_:1})]),_:1},8,[`value`])]),_:1})]),_:1},8,[`model`])]),_:1},8,[`open`,`title`,`confirmLoading`])])]),_:1})}}}),[[`__scopeId`,`data-v-0e571099`]]);export{R as default};