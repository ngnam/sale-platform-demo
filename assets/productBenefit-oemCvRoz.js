import"./menu-KmJeyBmp.js";import{n as e,t}from"./_plugin-vue_export-helper-DjLyun5i.js";import{a as n,i as r,o as i,r as a,t as o}from"./input-Dl58X2zG.js";import{t as s}from"./table-B5NlV_bM.js";import{r as c,t as l}from"./select-qwNyy2X6.js";import{o as u}from"./Col-Dn_WxAuq.js";import"./FolderOutlined-CuOYp4hi.js";import"./EyeInvisibleOutlined-DQ7XOaOB.js";import{t as d}from"./modal-7zbmb4iA.js";import"./move-BV2dG8Yt.js";import"./checkbox-DTOnil2W.js";import{t as f}from"./space-BwjoyeVf.js";import"./dropdown-BjYLSNDe.js";import"./UpOutlined-CVKY-LmD.js";import{t as p}from"./input-number-Cc1ZCS-y.js";import"./spin-CjGf5sPd.js";import{t as m}from"./popconfirm-Mr8MyDf8.js";import{Bn as h,Cn as g,Dn as _,En as v,Fn as y,Kn as b,Qn as x,Sn as S,Tn as C,Un as w,ir as T,kn as E,ln as D,pr as O,u as k,ur as A,xn as j}from"./index-DNW3ueIJ.js";import{t as M}from"./productBenefit-B0HzY-HR.js";const N=[{title:`No`,dataIndex:`index`,key:`index`,width:80},{title:`Benefit Id`,dataIndex:`benefitId`,key:`benefitId`,width:220,sorter:!0},{title:`Benefit Code`,dataIndex:`benefitCode`,key:`benefitCode`,width:180},{title:`Benefit Name`,dataIndex:`benefitName`,key:`benefitName`,width:320},{title:`Benefit Type`,dataIndex:`benefitType`,key:`benefitType`,width:160},{title:`Plan Id`,dataIndex:`planId`,key:`planId`,width:180},{title:`Action`,key:`action`,fixed:`right`,width:180}];var P={class:`product-benefit-page`},F={class:`title`},ee={style:{display:`flex`,gap:`12px`,"align-items":`center`,"margin-bottom":`8px`}},te={key:1},I=t(E({__name:`index`,props:{planId:{}},setup(t){let E=D(),I=t.planId??``,L=T(``),R=T(!1),z=T(!1),B=T(!1),V=T(!1),H=T(null),U=T(1),W=T(20),G=T(0),K=T([]),q=T([]),J={benefitId:``,benefitCode:``,benefitName:``,benefitType:`LIFE`,payableEvent:`DEATH`,limitAmount:void 0,calculationBasis:``,notes:``},Y=T({...J}),X=T(),Z=N,ne=j(()=>({current:U.value,pageSize:W.value,total:G.value,showSizeChanger:!0,showQuickJumper:!0})),re=e=>e.benefitId,ie=j(()=>K.value.map((e,t)=>({...e,index:(U.value-1)*W.value+t+1}))),ae=j(()=>({selectedRowKeys:q.value,onChange:e=>{q.value=e.slice()}})),oe={benefitId:[{required:!0,message:`BenefitId required`,trigger:`blur`}],benefitCode:[{required:!0,message:`Benefit code required`,trigger:`blur`}],benefitName:[{required:!0,message:`Benefit name required`,trigger:`blur`}]};async function Q(){R.value=!0;try{let e=await M.getAll(I),t=e.data??e??[];K.value=Array.from(t),G.value=K.value.length}catch(e){console.error(e),k.error(`Load product benefits failed`)}finally{R.value=!1}}let $=async()=>{U.value=1,await Q()},se=async e=>{e&&(U.value=e.current||U.value,W.value=e.pageSize||W.value),await Q()},ce=async()=>{V.value=!1,H.value=null,Object.assign(Y.value,JSON.parse(JSON.stringify(J))),B.value=!0,await y(),X.value?.resetFields?.(JSON.parse(JSON.stringify(J))),X.value?.clearValidate?.()};async function le(e){V.value=!0,H.value=e.benefitId;try{let t=await M.getDetail(I,e.benefitId),n=t.data??t;Object.assign(Y.value,{benefitId:n.benefitId,benefitCode:n.benefitCode,benefitName:n.benefitName,benefitType:n.benefitType,payableEvent:n.payableEvent,limitAmount:n.limitAmount??void 0,calculationBasis:n.calculationBasis??``,notes:n.notes??``}),B.value=!0,await y(),X.value?.clearValidate?.()}catch(e){console.error(e),k.error(`Load benefit detail failed`)}}async function ue(e){d.confirm({title:`Delete benefit`,content:`Delete benefit ${e.benefitId}?`,onOk:async()=>{try{await M.remove(I,e.benefitId),k.success(`Deleted`),q.value=q.value.filter(t=>t!==e.benefitId),Q()}catch(e){console.error(e),k.error(`Delete failed`)}}})}function de(e){E.push({name:`ProductBenefitDetail`,params:{planId:I,benefitId:e.benefitId}}).catch(()=>{})}let fe=async()=>{q.value.length&&d.confirm({title:`Delete ${q.value.length} benefit(s)`,content:`Are you sure to delete selected benefits?`,onOk:async()=>{try{for(let e of[...q.value])await M.remove(I,e);k.success(`Deleted selected`),q.value=[],U.value=1,Q()}catch(e){console.error(e),k.error(`Delete failed`)}}})},pe=async()=>{try{await X.value?.validate?.()}catch{return}let e={benefitId:(Y.value.benefitId??``).trim(),benefitCode:(Y.value.benefitCode??``).trim(),benefitName:(Y.value.benefitName??``).trim(),benefitType:Y.value.benefitType??``,payableEvent:Y.value.payableEvent??``,limitAmount:Y.value.limitAmount??null,calculationBasis:Y.value.calculationBasis??null,notes:Y.value.notes??null},t={benefitCode:(Y.value.benefitCode??``).trim(),benefitName:(Y.value.benefitName??``).trim(),benefitType:Y.value.benefitType??null,payableEvent:Y.value.payableEvent??null,limitAmount:Y.value.limitAmount??null,calculationBasis:Y.value.calculationBasis??null,notes:Y.value.notes??null};z.value=!0;try{V.value&&H.value?(await M.update(I,H.value,t),k.success(`Updated`)):(await M.create(I,e),k.success(`Created`)),B.value=!1,q.value=[],await Q()}catch(e){console.error(e),k.error(String(e?.response?.data?.message??`Save failed`))}finally{z.value=!1}},me=()=>{B.value=!1};return h(async()=>{await Q()}),(t,h)=>{let y=r,T=e,E=m,D=f,k=s,j=u,M=o,N=i,H=l,U=c,W=p,G=a,K=n,J=d,he=b(`router-view`);return w(),g(he,null,{default:x(({route:e})=>[S(`div`,P,[S(`h2`,F,`Product Benefits for `+O(A(I)),1),_(j,{class:`mb16`,"body-style":{padding:`12px`}},{default:x(()=>[S(`div`,ee,[_(y,{value:L.value,"onUpdate:value":h[0]||=e=>L.value=e,placeholder:`Search by code or name`,onSearch:$,style:{width:`360px`},allowClear:``},null,8,[`value`]),_(T,{type:`primary`,onClick:ce},{default:x(()=>[...h[10]||=[v(`Create Benefit`,-1)]]),_:1}),_(T,{danger:``,disabled:!q.value.length,onClick:fe},{default:x(()=>[...h[11]||=[v(`Delete Selected`,-1)]]),_:1},8,[`disabled`]),_(T,{loading:R.value,onClick:Q},{default:x(()=>[...h[12]||=[v(`Refresh`,-1)]]),_:1},8,[`loading`])]),_(k,{columns:A(Z),dataSource:ie.value,loading:R.value,pagination:ne.value,rowKey:re,rowSelection:ae.value,scroll:{x:1200},onChange:se},{bodyCell:x(({column:e,record:t})=>[e.key===`action`?(w(),g(D,{key:0,style:{"justify-content":`flex-end`,width:`100%`}},{default:x(()=>[_(T,{size:`small`,onClick:()=>de(t)},{default:x(()=>[...h[13]||=[v(`View`,-1)]]),_:1},8,[`onClick`]),_(T,{size:`small`,type:`primary`,onClick:()=>le(t)},{default:x(()=>[...h[14]||=[v(`Edit`,-1)]]),_:1},8,[`onClick`]),_(E,{placement:`bottom`,title:`Delete this benefit?`,onConfirm:()=>ue(t)},{default:x(()=>[_(T,{size:`small`,danger:``},{default:x(()=>[...h[15]||=[v(`Delete`,-1)]]),_:1})]),_:1},8,[`onConfirm`])]),_:2},1024)):(w(),C(`span`,te,O(t[e.dataIndex]),1))]),_:1},8,[`columns`,`dataSource`,`loading`,`pagination`,`rowSelection`])]),_:1}),_(J,{open:B.value,"onUpdate:open":h[9]||=e=>B.value=e,title:V.value?`Edit Benefit`:`Create Benefit`,onOk:pe,onCancel:me,confirmLoading:z.value,width:760,centered:``},{default:x(()=>[_(K,{ref_key:`formRef`,ref:X,model:Y.value,rules:oe,layout:`vertical`},{default:x(()=>[_(N,{label:`Benefit Id`,name:`benefitId`,rules:V.value?[]:[{required:!0,message:`BenefitId required`}]},{default:x(()=>[_(M,{value:Y.value.benefitId,"onUpdate:value":h[1]||=e=>Y.value.benefitId=e,disabled:V.value,placeholder:`Unique id`},null,8,[`value`,`disabled`])]),_:1},8,[`rules`]),_(N,{label:`Benefit Code`,name:`benefitCode`,rules:[{required:!0,message:`Benefit code required`}]},{default:x(()=>[_(M,{value:Y.value.benefitCode,"onUpdate:value":h[2]||=e=>Y.value.benefitCode=e,placeholder:`e.g. BFT001`},null,8,[`value`])]),_:1}),_(N,{label:`Benefit Name`,name:`benefitName`,rules:[{required:!0,message:`Benefit name required`}]},{default:x(()=>[_(M,{value:Y.value.benefitName,"onUpdate:value":h[3]||=e=>Y.value.benefitName=e,placeholder:`Benefit display name`},null,8,[`value`])]),_:1}),_(N,{label:`Benefit Type`,name:`benefitType`},{default:x(()=>[_(U,{value:Y.value.benefitType,"onUpdate:value":h[4]||=e=>Y.value.benefitType=e,placeholder:`Select type`},{default:x(()=>[_(H,{value:`MAIN`},{default:x(()=>[...h[16]||=[v(`MAIN`,-1)]]),_:1}),_(H,{value:`LIFE`},{default:x(()=>[...h[17]||=[v(`LIFE`,-1)]]),_:1}),_(H,{value:`HEALTH`},{default:x(()=>[...h[18]||=[v(`HEALTH`,-1)]]),_:1}),_(H,{value:`RIDER`},{default:x(()=>[...h[19]||=[v(`RIDER`,-1)]]),_:1})]),_:1},8,[`value`])]),_:1}),_(N,{label:`Payable Event`,name:`payableEvent`},{default:x(()=>[_(U,{value:Y.value.payableEvent,"onUpdate:value":h[5]||=e=>Y.value.payableEvent=e,placeholder:`Select event`},{default:x(()=>[_(H,{value:`DEATH`},{default:x(()=>[...h[20]||=[v(`DEATH`,-1)]]),_:1}),_(H,{value:`MATURITY`},{default:x(()=>[...h[21]||=[v(`MATURITY`,-1)]]),_:1}),_(H,{value:`CRITICAL_ILLNESS`},{default:x(()=>[...h[22]||=[v(`CRITICAL_ILLNESS`,-1)]]),_:1})]),_:1},8,[`value`])]),_:1}),_(N,{label:`Limit Amount`,name:`limitAmount`},{default:x(()=>[_(W,{value:Y.value.limitAmount,"onUpdate:value":h[6]||=e=>Y.value.limitAmount=e,style:{width:`100%`}},null,8,[`value`])]),_:1}),_(N,{label:`Calculation Basis`,name:`calculationBasis`},{default:x(()=>[_(M,{value:Y.value.calculationBasis,"onUpdate:value":h[7]||=e=>Y.value.calculationBasis=e,placeholder:`formula or basis`},null,8,[`value`])]),_:1}),_(N,{label:`Notes`,name:`notes`},{default:x(()=>[_(G,{value:Y.value.notes,"onUpdate:value":h[8]||=e=>Y.value.notes=e,rows:3},null,8,[`value`])]),_:1})]),_:1},8,[`model`])]),_:1},8,[`open`,`title`,`confirmLoading`])])]),_:1})}}}),[[`__scopeId`,`data-v-c12beb6a`]]);export{I as default};