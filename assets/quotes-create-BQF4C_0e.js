import"./EyeInvisibleOutlined-vBZdbnb5.js";import{n as e,t}from"./_plugin-vue_export-helper-CCMMWqEJ.js";import{a as n,o as r,t as i}from"./input-CE70cYGf.js";import{t as a}from"./table-Bj7AWOqL.js";import{r as o,t as s}from"./select-BktQDR1e.js";import{o as c}from"./Col-B88sKFw0.js";import"./FolderOutlined-v8Whbuap.js";import"./checkbox-o3cgUXip.js";import{t as l}from"./page-header-C9rWw0m-.js";import"./space-CGZIuoRS.js";import"./dropdown-kgT51ow1.js";import"./breadcrumb-DhykEvSa.js";import{n as u,t as d}from"./row-CYcdmHKM.js";import"./UpOutlined-ZUi5vTGj.js";import{t as f}from"./input-number-Jr8dvtpE.js";import"./spin-D756cOu2.js";import"./ArrowRightOutlined-BTInphOv.js";import{Cn as p,Dn as m,En as h,It as g,J as _,Mt as v,R as y,Rn as b,Sn as x,Tn as S,U as C,Un as ee,Vn as w,W as T,Xn as E,an as D,bn as O,cn as k,dr as A,gn as j,l as M,nr as N,on as P,sn as F,tr as I,wn as L,xn as R}from"./index-DYE8AE99.js";import{n as z,r as B,t as V}from"./illustration-CPLV9fxe.js";import{t as H}from"./pricingVersion-DI3n4qna.js";import{t as U}from"./productPlan-DbpaFBUo.js";import{t as W}from"./rider-I66MQYoI.js";var G=e=>{let{componentCls:t,sizePaddingEdgeHorizontal:n,colorSplit:r,lineWidth:i}=e;return{[t]:D(D({},_(e)),{borderBlockStart:`${i}px solid ${r}`,"&-vertical":{position:`relative`,top:`-0.06em`,display:`inline-block`,height:`0.9em`,margin:`0 ${e.dividerVerticalGutterMargin}px`,verticalAlign:`middle`,borderTop:0,borderInlineStart:`${i}px solid ${r}`},"&-horizontal":{display:`flex`,clear:`both`,width:`100%`,minWidth:`100%`,margin:`${e.dividerHorizontalGutterMargin}px 0`},[`&-horizontal${t}-with-text`]:{display:`flex`,alignItems:`center`,margin:`${e.dividerHorizontalWithTextGutterMargin}px 0`,color:e.colorTextHeading,fontWeight:500,fontSize:e.fontSizeLG,whiteSpace:`nowrap`,textAlign:`center`,borderBlockStart:`0 ${r}`,"&::before, &::after":{position:`relative`,width:`50%`,borderBlockStart:`${i}px solid transparent`,borderBlockStartColor:`inherit`,borderBlockEnd:0,transform:`translateY(50%)`,content:`''`}},[`&-horizontal${t}-with-text-left`]:{"&::before":{width:`5%`},"&::after":{width:`95%`}},[`&-horizontal${t}-with-text-right`]:{"&::before":{width:`95%`},"&::after":{width:`5%`}},[`${t}-inner-text`]:{display:`inline-block`,padding:`0 1em`},"&-dashed":{background:`none`,borderColor:r,borderStyle:`dashed`,borderWidth:`${i}px 0 0`},[`&-horizontal${t}-with-text${t}-dashed`]:{"&::before, &::after":{borderStyle:`dashed none none`}},[`&-vertical${t}-dashed`]:{borderInlineStartWidth:i,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},[`&-plain${t}-with-text`]:{color:e.colorText,fontWeight:`normal`,fontSize:e.fontSize},[`&-horizontal${t}-with-text-left${t}-no-default-orientation-margin-left`]:{"&::before":{width:0},"&::after":{width:`100%`},[`${t}-inner-text`]:{paddingInlineStart:n}},[`&-horizontal${t}-with-text-right${t}-no-default-orientation-margin-right`]:{"&::before":{width:`100%`},"&::after":{width:0},[`${t}-inner-text`]:{paddingInlineEnd:n}}})}},K=T(`Divider`,e=>{let t=C(e,{dividerVerticalGutterMargin:e.marginXS,dividerHorizontalWithTextGutterMargin:e.margin,dividerHorizontalGutterMargin:e.marginLG});return[G(t)]},{sizePaddingEdgeHorizontal:0}),q=m({name:`ADivider`,inheritAttrs:!1,compatConfig:{MODE:3},props:(()=>({prefixCls:String,type:{type:String,default:`horizontal`},dashed:{type:Boolean,default:!1},orientation:{type:String,default:`center`},plain:{type:Boolean,default:!1},orientationMargin:[String,Number]}))(),setup(e,t){let{slots:n,attrs:r}=t,{prefixCls:i,direction:a}=y(`divider`,e),[o,s]=K(i),c=O(()=>e.orientation===`left`&&e.orientationMargin!=null),l=O(()=>e.orientation===`right`&&e.orientationMargin!=null),u=O(()=>{let{type:t,dashed:n,plain:r}=e,o=i.value;return{[o]:!0,[s.value]:!!s.value,[`${o}-${t}`]:!0,[`${o}-dashed`]:!!n,[`${o}-plain`]:!!r,[`${o}-rtl`]:a.value===`rtl`,[`${o}-no-default-orientation-margin-left`]:c.value,[`${o}-no-default-orientation-margin-right`]:l.value}}),d=O(()=>{let t=typeof e.orientationMargin==`number`?`${e.orientationMargin}px`:e.orientationMargin;return D(D({},c.value&&{marginLeft:t}),l.value&&{marginRight:t})}),f=O(()=>e.orientation.length>0?`-`+e.orientation:e.orientation);return()=>{let e=g(n.default?.call(n));return o(h(`div`,P(P({},r),{},{class:[u.value,e.length?`${i.value}-with-text ${i.value}-with-text${f.value}`:``,r.class],role:`separator`}),[e.length?h(`span`,{class:`${i.value}-inner-text`,style:d.value},[e]):null]))}}}),te=v(q),ne={style:{display:`flex`,gap:`12px`,"margin-top":`16px`}},J=t(m({__name:`index`,setup(t){let m=N(!1),g=k(),_=F();function v(){g.back()}let y=N(!1),C=N(!1),T=N(!1),D=N(!1),O=N(!1),P=N(null),G=N([]),K=N([]),q=N([]),J=N([]),Y=N([]),X=I({appId:_.query.appId?String(_.query.appId):void 0,planId:``,pricingVersionId:``,mode:`MONTHLY`,sumAssured:1e7,termYears:null,termMonths:null,insuredAge:30,insuredSex:`M`,insuredSmoker:!1,riders:[],note:``}),re=[{title:`Rider`,dataIndex:`riderCode`,key:`riderCode`},{title:`Units/SA`,dataIndex:`units`,key:`units`},{title:`Premium`,dataIndex:`premium`,key:`premium`}],ie=[{title:`Policy Year`,dataIndex:`policyYear`,key:`policyYear`},{title:`Premium Annual`,dataIndex:`premiumAnnual`,key:`premiumAnnual`},{title:`GCV`,dataIndex:`gcv`,key:`gcv`},{title:`Surrender Value`,dataIndex:`surrenderValue`,key:`surrenderValue`},{title:`Death Benefit`,dataIndex:`deathBenefit`,key:`deathBenefit`}];function Z(e,t){return(t?.label??``).toLowerCase().includes((e||``).toLowerCase())}async function Q(){C.value=!0;try{let e=await U.getAll({page:1,pageSize:500})??[],t=e.data??e??[];q.value=(Array.isArray(t)?t:t.items??t.Items??[]).map(e=>({label:e.planId??e.name,value:e.planId}))}catch(e){console.error(e)}finally{C.value=!1}}async function $(e=!0){if(!(!e||!X.planId)){T.value=!0;try{let e=await H.getAll(X.planId)??[],t=e.data??e??[];J.value=(Array.isArray(t)?t:t.items??t.Items??[]).map(e=>({label:e.pricingVersionId??e.name,value:e.pricingVersionId}))}catch(e){console.error(e)}finally{T.value=!1}}}async function ae(e=!0){if(e){D.value=!0;try{let e=await W.queryMasters(),t=e.data??e??[];Y.value=(Array.isArray(t)?t:[]).map(e=>({label:`${e.name} (${e.riderCode})`,value:e.riderCode}))}catch(e){console.error(e)}finally{D.value=!1}}}async function oe(e=!0){if(e){O.value=!0;try{let e=await B.getAll({page:1,pageSize:200})??[],t=e.data??e??[];K.value=(Array.isArray(t)?t:t.items??t.Items??[]).map(e=>({label:`${e?.lead?.fullName??e.appId}`,value:e.appId}))}catch(e){console.error(e)}finally{O.value=!1}}}function se(){X.riders.push({riderCode:``,riderSaOrUnits:0,units:0})}function ce(e){X.riders.splice(e,1)}function le(){X.planId=``,X.pricingVersionId=``,X.mode=`MONTHLY`,X.sumAssured=1e7,X.termYears=null,X.termMonths=null,X.insuredAge=30,X.insuredSex=`M`,X.insuredSmoker=!1,X.riders=[],X.note=``,P.value=null,G.value=[]}async function ue(){if(!X.planId||!X.pricingVersionId){M.warn(`Choose plan and pricing version`);return}y.value=!0;try{let e={appId:X.appId??null,planId:X.planId,pricingVersionId:X.pricingVersionId,mode:X.mode,sumAssured:Number(X.sumAssured),termYears:X.termYears??void 0,termMonths:X.termMonths??void 0,insuredAge:Number(X.insuredAge),insuredSex:X.insuredSex,insuredSmoker:!!X.insuredSmoker,riders:X.riders?.filter(e=>e.riderCode).map(e=>({riderCode:e.riderCode,riderSaOrUnits:Number(e.riderSaOrUnits||0),units:Number(e.units||0)}))??[]},t=await z.create(e);if(P.value=t.data??t??null,M.success(`Quote created`),P.value?.illustrationId){let e=await V.getDetail(P.value.illustrationId),t=e.data??e??{};G.value=t.illuYearlies??t.IlluYearlies??t.illuyearlies??[]}}catch(e){console.error(e),M.error(`Create quote failed`)}finally{y.value=!1}}function de(e){if(!e)return null;let t=/filename\*?=(?:UTF-8'')?["']?([^;"']+)["']?/i.exec(e);if(!t)return null;try{return decodeURIComponent(t[1].replace(/['"]/g,``))}catch{return t[1].replace(/['"]/g,``)}}async function fe(){if(!P.value?.illustrationId){M.warn(`No PDF`);return}m.value=!0;try{let e=await V.getPdf(P.value.illustrationId),t,n=`illustration-${P.value.illustrationId}.pdf`;if(e&&typeof e==`object`&&`data`in e){t=e.data instanceof Blob?e.data:new Blob([e.data],{type:`application/pdf`});let r=(e.headers&&(e.headers[`content-disposition`]||e.headers[`Content-Disposition`]))??null;n=de(r)??n}else if(e&&typeof e.blob==`function`){t=await e.blob();let r=e.headers?.get?.(`content-disposition`)??null;n=de(r)??n}else t=e instanceof Blob?e:new Blob([JSON.stringify(e)],{type:`application/pdf`});let r=window.URL.createObjectURL(t),i=document.createElement(`a`);i.href=r,i.download=n,document.body.appendChild(i),i.click(),i.remove(),window.URL.revokeObjectURL(r),M.success(`Download started`)}catch(e){console.error(e),M.error(e?.message??`Download failed`)}finally{m.value=!1}}return b(()=>{Q(),$(),ae()}),(t,g)=>{let _=l,b=o,k=r,M=u,N=d,F=s,I=f,z=i,B=te,V=e,H=n,U=c,W=a;return w(),L(j,null,[h(_,{title:`Create Quote`,onBack:v}),h(U,{class:`mb16`},{default:E(()=>[h(H,{layout:`vertical`},{default:E(()=>[h(N,{gutter:12},{default:E(()=>[h(M,{span:8},{default:E(()=>[h(k,{label:`Application`},{default:E(()=>[h(b,{value:X.appId,"onUpdate:value":g[0]||=e=>X.appId=e,options:K.value,"show-search":``,allowClear:``,placeholder:`Select application`,onDropdownVisibleChange:oe,loading:O.value,filterOption:Z},null,8,[`value`,`options`,`loading`])]),_:1})]),_:1}),h(M,{span:8},{default:E(()=>[h(k,{label:`Product (Plan)`},{default:E(()=>[h(b,{value:X.planId,"onUpdate:value":g[1]||=e=>X.planId=e,options:q.value,"show-search":``,allowClear:``,placeholder:`Select plan`,onDropdownVisibleChange:Q,loading:C.value,filterOption:Z},null,8,[`value`,`options`,`loading`])]),_:1})]),_:1}),h(M,{span:8},{default:E(()=>[h(k,{label:`Pricing Version`},{default:E(()=>[h(b,{value:X.pricingVersionId,"onUpdate:value":g[2]||=e=>X.pricingVersionId=e,options:J.value,"show-search":``,allowClear:``,placeholder:`Select pricing version`,onDropdownVisibleChange:$,loading:T.value,filterOption:Z},null,8,[`value`,`options`,`loading`])]),_:1})]),_:1})]),_:1}),h(N,{gutter:12},{default:E(()=>[h(M,{span:6},{default:E(()=>[h(k,{label:`Mode`},{default:E(()=>[h(b,{value:X.mode,"onUpdate:value":g[3]||=e=>X.mode=e},{default:E(()=>[h(F,{value:`MONTHLY`},{default:E(()=>[...g[10]||=[S(`MONTHLY`,-1)]]),_:1}),h(F,{value:`ONE_TIME`},{default:E(()=>[...g[11]||=[S(`ONE_TIME`,-1)]]),_:1})]),_:1},8,[`value`])]),_:1})]),_:1}),h(M,{span:6},{default:E(()=>[h(k,{label:`Sum Assured`},{default:E(()=>[h(I,{value:X.sumAssured,"onUpdate:value":g[4]||=e=>X.sumAssured=e,style:{width:`100%`},step:1e3},null,8,[`value`])]),_:1})]),_:1}),h(M,{span:6},{default:E(()=>[h(k,{label:`Term Months`},{default:E(()=>[h(I,{value:X.termMonths,"onUpdate:value":g[5]||=e=>X.termMonths=e,style:{width:`100%`},min:0},null,8,[`value`])]),_:1})]),_:1})]),_:1}),h(N,{gutter:12},{default:E(()=>[h(M,{span:4},{default:E(()=>[h(k,{label:`Insured Age`},{default:E(()=>[h(I,{value:X.insuredAge,"onUpdate:value":g[6]||=e=>X.insuredAge=e,style:{width:`100%`}},null,8,[`value`])]),_:1})]),_:1}),h(M,{span:4},{default:E(()=>[h(k,{label:`Sex`},{default:E(()=>[h(b,{value:X.insuredSex,"onUpdate:value":g[7]||=e=>X.insuredSex=e},{default:E(()=>[h(F,{value:`M`},{default:E(()=>[...g[12]||=[S(`M`,-1)]]),_:1}),h(F,{value:`F`},{default:E(()=>[...g[13]||=[S(`F`,-1)]]),_:1})]),_:1},8,[`value`])]),_:1})]),_:1}),h(M,{span:4},{default:E(()=>[h(k,{label:`Smoker`},{default:E(()=>[h(b,{value:X.insuredSmoker,"onUpdate:value":g[8]||=e=>X.insuredSmoker=e},{default:E(()=>[h(F,{value:!1},{default:E(()=>[...g[14]||=[S(`No`,-1)]]),_:1}),h(F,{value:!0},{default:E(()=>[...g[15]||=[S(`Yes`,-1)]]),_:1})]),_:1},8,[`value`])]),_:1})]),_:1}),h(M,{span:12},{default:E(()=>[h(k,{label:`Reference / Note`},{default:E(()=>[h(z,{value:X.note,"onUpdate:value":g[9]||=e=>X.note=e},null,8,[`value`])]),_:1})]),_:1})]),_:1}),h(B,null,{default:E(()=>[...g[16]||=[S(`Riders (Optional)`,-1)]]),_:1}),(w(!0),L(j,null,ee(X.riders,(e,t)=>(w(),L(`div`,{key:t,style:{display:`flex`,gap:`8px`,"margin-bottom":`8px`}},[h(b,{value:e.riderCode,"onUpdate:value":t=>e.riderCode=t,options:Y.value,placeholder:`Rider`,style:{width:`260px`},onDropdownVisibleChange:ae,loading:D.value,filterOption:Z},null,8,[`value`,`onUpdate:value`,`options`,`loading`]),h(I,{value:e.riderSaOrUnits,"onUpdate:value":t=>e.riderSaOrUnits=t,placeholder:`SA / Units`,style:{width:`180px`},step:1e3},null,8,[`value`,`onUpdate:value`]),h(I,{value:e.units,"onUpdate:value":t=>e.units=t,placeholder:`Units`,style:{width:`120px`}},null,8,[`value`,`onUpdate:value`]),h(V,{danger:``,onClick:e=>ce(t)},{default:E(()=>[...g[17]||=[S(`Remove`,-1)]]),_:1},8,[`onClick`])]))),128)),h(V,{type:`dashed`,block:``,onClick:se},{default:E(()=>[...g[18]||=[S(`+ Add Rider`,-1)]]),_:1}),R(`div`,ne,[h(V,{type:`primary`,loading:y.value,onClick:ue},{default:E(()=>[...g[19]||=[S(`Create Quote`,-1)]]),_:1},8,[`loading`]),h(V,{onClick:le},{default:E(()=>[...g[20]||=[S(`Reset`,-1)]]),_:1})])]),_:1})]),_:1}),P.value?(w(),x(U,{key:0,title:`Quote Result`,class:`mb16`},{default:E(()=>[h(N,{gutter:12},{default:E(()=>[h(M,{span:8},{default:E(()=>[g[21]||=R(`b`,null,`Total Premium`,-1),R(`div`,null,A(P.value.totalPremium),1)]),_:1}),h(M,{span:8},{default:E(()=>[g[22]||=R(`b`,null,`Base`,-1),R(`div`,null,A(P.value.breakdownBase),1)]),_:1}),h(M,{span:8},{default:E(()=>[g[23]||=R(`b`,null,`Riders`,-1),R(`div`,null,A(P.value.breakdownRiders),1)]),_:1})]),_:1}),h(W,{columns:re,dataSource:P.value.riders||[],pagination:!1,rowKey:`riderCode`,class:`mt12`},null,8,[`dataSource`]),P.value.pdfUri?(w(),x(V,{key:0,type:`link`,onClick:fe,loading:m.value},{default:E(()=>[...g[24]||=[S(`Download Illustration`,-1)]]),_:1},8,[`loading`])):p(``,!0)]),_:1})):p(``,!0),G.value.length?(w(),x(U,{key:1,title:`Illustration (yearly)`},{default:E(()=>[h(W,{columns:ie,dataSource:G.value,pagination:!1,rowKey:`policyYear`},null,8,[`dataSource`])]),_:1})):p(``,!0)],64)}}}),[[`__scopeId`,`data-v-6f70031f`]]);export{J as default};