import"./menu-Bhhdg46M.js";import{n as e,t}from"./_plugin-vue_export-helper-DPrR5wxB.js";import{a as n,o as r}from"./input-eiSd8m4U.js";import{t as i}from"./table-CUhhiDtX.js";import{r as a}from"./select-CUdbhWXi.js";import{o as ee}from"./Col-BC3b6lLj.js";import"./FolderOutlined-BkULr9jo.js";import"./EyeInvisibleOutlined-CiHbfsZv.js";import{t as o}from"./modal-BY8tMKRC.js";import"./move-CCKEGgz9.js";import"./checkbox-CSeGYwQi.js";import{t as s}from"./page-header-DW6OThUJ.js";import{t as c}from"./space-bW3FXfWa.js";import"./dropdown-DVBnKecP.js";import"./breadcrumb-Cuub1Zew.js";import{n as l,t as u}from"./row-B4B5NydT.js";import"./UpOutlined-BExqSuUa.js";import{t as te}from"./input-number-DG2hPLsZ.js";import"./spin-BdioGjXa.js";import"./ArrowRightOutlined-BcK4grMB.js";import{t as d}from"./popconfirm-D6WnTNwW.js";import{Bn as f,Cn as p,Dn as m,En as h,Qn as g,Sn as ne,Tn as _,Un as v,_n as y,ir as b,kn as x,pr as S,rr as C,u as w,xn as T}from"./index-_V7Bdtlq.js";import{t as E}from"./pricingVersion-BT5qkrK_.js";import{t as D}from"./productPlan-B1grtpIq.js";import{t as O}from"./rider-ByQJ3_Ea.js";var k={style:{display:`flex`,gap:`8px`,"align-items":`center`}},A={key:1},j=t(x({__name:`index`,setup(t){let x=b(void 0),j=b(void 0),M=b(void 0),N=b([]),P=b([]),F=b([]),I=b(!1),L=T(()=>F.value.map(e=>({label:`${e.name} (${e.riderCode})`,value:e.riderCode}))),R=b([]),z=b(!1),B=b(1),V=b(20),H=b(0),U=C({current:B.value,pageSize:V.value,total:H.value,showSizeChanger:!0,pageSizeOptions:[`10`,`20`,`50`,`100`]});async function W(e=!0){if(!e)return;let t=x.value||Z.planId;if(t)try{let e=await E.getAll(t)??[],n=e.data??e??[];N.value=(Array.isArray(n)?n:n.items??n.Items??[]).map(e=>({label:e.pricingVersionId??e.name,value:e.pricingVersionId}))}catch(e){console.error(e)}}async function G(e=!0){if(e){I.value=!0;try{let e=await D.getAll({page:1,pageSize:500}),t=e.data??e??[];P.value=((Array.isArray(t)?t:t.items??t.Items??[])??[]).map(e=>({label:e.planId??e.planCode??e.name,value:e.planId??e.id}))}catch(e){console.error(e)}finally{I.value=!1}}}async function K(){try{let e=await O.queryMasters();F.value=e.data??e??[]}catch(e){console.error(e)}}async function q(e=B.value,t=V.value){z.value=!0;try{let n=await O.queryRates({pricingVersionId:j.value,riderCode:M.value,page:e,pageSize:t}),r=n.data??n??{},i=r.items??r.Items??r.Items??[],a=r.totalItems??r.TotalItems??r.total??0;R.value=Array.isArray(i)?i:[],H.value=Number(a)||0,B.value=r.page??e,V.value=r.pageSize??t,U.current=B.value,U.pageSize=V.value,U.total=H.value}catch(e){console.error(e),w.error(`Tải rate thất bại`)}finally{z.value=!1}}function J(e){let t=e.current??1,n=e.pageSize??V.value;B.value=t,V.value=n,q(t,n)}let Y=b(!1),X=b(!1),Z=C({planId:``,pricingVersionId:``,riderCode:``,ageMin:0,ageMax:0,ratePer1000:null,ratePerUnit:null,percentOfBase:null}),Q=b(null),re=[{title:`Pricing Version`,dataIndex:`pricingVersionId`,key:`pricingVersionId`},{title:`Rider`,dataIndex:`riderCode`,key:`riderCode`},{title:`Age Min`,dataIndex:`ageMin`,key:`ageMin`},{title:`Age Max`,dataIndex:`ageMax`,key:`ageMax`},{title:`Rate/1000`,dataIndex:`ratePer1000`,key:`ratePer1000`},{title:`Rate/Unit`,dataIndex:`ratePerUnit`,key:`ratePerUnit`},{title:`% Of Base`,dataIndex:`percentOfBase`,key:`percentOfBase`},{title:`Action`,key:`action`,fixed:`right`,width:160}],ie=T(()=>Q.value?`Sửa rate ${Q.value}`:`Tạo rate mới`);function $(e){e?(Z.pricingVersionId=e.pricingVersionId,Z.riderCode=e.riderCode,Z.ageMin=e.ageMin,Z.ageMax=e.ageMax,Z.ratePer1000=e.ratePer1000??null,Z.ratePerUnit=e.ratePerUnit??null,Z.percentOfBase=e.percentOfBase??null,Q.value=`${e.pricingVersionId}::${e.riderCode}::${e.ageMin}::${e.ageMax}`):(Z.pricingVersionId=j.value??``,Z.riderCode=M.value??``,Z.ageMin=0,Z.ageMax=0,Z.ratePer1000=null,Z.ratePerUnit=null,Z.percentOfBase=null,Q.value=null),Y.value=!0}async function ae(){X.value=!0;try{if(!Z.pricingVersionId||!Z.riderCode){w.warn(`Chọn pricing version và rider`);return}if(Z.ageMin>Z.ageMax){w.warn(`AgeMin phải <= AgeMax`);return}let e={pricingVersionId:Z.pricingVersionId,riderCode:Z.riderCode,ageMin:Z.ageMin,ageMax:Z.ageMax,ratePer1000:Z.ratePer1000,ratePerUnit:Z.ratePerUnit,percentOfBase:Z.percentOfBase};if(Q.value){let[t,n,r,i]=Q.value.split(`::`);await O.updateRate(t??``,n??``,Number(r),Number(i),e),w.success(`Cập nhật rate thành công`)}else await O.createRate(e),w.success(`Tạo rate thành công`);Y.value=!1,await q()}catch(e){console.error(e),w.error(e?.message??`Lưu thất bại`)}finally{X.value=!1}}async function oe(e){try{await O.deleteRate(e.pricingVersionId,e.riderCode,e.ageMin,e.ageMax),w.success(`Xóa thành công`),await q()}catch(e){console.error(e),w.error(e?.message??`Xóa thất bại`)}}return f(()=>{W(),K(),q(1,V.value)}),(t,f)=>{let b=s,C=a,w=e,T=ee,E=d,D=c,O=i,F=r,B=l,V=u,H=te,K=n,Q=o;return v(),_(y,null,[m(b,{title:`Cấu hình Tỷ lệ Rider`}),m(T,{class:`mb12`},{default:g(()=>[ne(`div`,k,[m(C,{value:x.value,"onUpdate:value":f[0]||=e=>x.value=e,placeholder:`Plan`,style:{width:`240px`},"show-search":``,allowClear:``,options:P.value,loading:I.value,onDropdownVisibleChange:G},null,8,[`value`,`options`,`loading`]),m(C,{value:j.value,"onUpdate:value":f[1]||=e=>j.value=e,placeholder:`Pricing Version`,style:{width:`240px`},"show-search":``,onDropdownVisibleChange:W,options:N.value,onChange:f[2]||=()=>q()},null,8,[`value`,`options`]),m(C,{value:M.value,"onUpdate:value":f[3]||=e=>M.value=e,placeholder:`Rider`,style:{width:`240px`},options:L.value,allowClear:``,onChange:f[4]||=()=>q()},null,8,[`value`,`options`]),m(w,{type:`primary`,onClick:f[5]||=e=>$()},{default:g(()=>[...f[17]||=[h(`Tạo Rate`,-1)]]),_:1}),m(w,{onClick:f[6]||=()=>q()},{default:g(()=>[...f[18]||=[h(`Làm mới`,-1)]]),_:1})])]),_:1}),m(T,{title:`Danh sách Rate`},{default:g(()=>[m(O,{columns:re,dataSource:R.value,rowKey:e=>`${e.pricingVersionId}::${e.riderCode}::${e.ageMin}::${e.ageMax}`,pagination:U,loading:z.value,onChange:J,scroll:{x:1200,y:500}},{bodyCell:g(({column:e,record:t})=>[e.key===`action`?(v(),p(D,{key:0,style:{"justify-content":`flex-end`,width:`100%`}},{default:g(()=>[m(w,{size:`small`,onClick:e=>$(t)},{default:g(()=>[...f[19]||=[h(`Sửa`,-1)]]),_:1},8,[`onClick`]),m(E,{title:`Xóa rate này?`,onConfirm:()=>oe(t)},{default:g(()=>[m(w,{size:`small`,danger:``},{default:g(()=>[...f[20]||=[h(`Xóa`,-1)]]),_:1})]),_:1},8,[`onConfirm`])]),_:2},1024)):(v(),_(`span`,A,S(t[e.dataIndex]),1))]),_:1},8,[`dataSource`,`rowKey`,`pagination`,`loading`])]),_:1}),m(Q,{visible:Y.value,"onUpdate:visible":f[15]||=e=>Y.value=e,title:ie.value,onOk:ae,onCancel:f[16]||=e=>Y.value=!1,confirmLoading:X.value},{default:g(()=>[m(K,{layout:`vertical`},{default:g(()=>[m(V,{gutter:8},{default:g(()=>[m(B,{span:12},{default:g(()=>[m(F,{label:`Plan Id`},{default:g(()=>[m(C,{value:Z.planId,"onUpdate:value":f[7]||=e=>Z.planId=e,options:P.value,onDropdownVisibleChange:G},null,8,[`value`,`options`])]),_:1})]),_:1}),m(B,{span:12},{default:g(()=>[m(F,{label:`Pricing Version`},{default:g(()=>[m(C,{value:Z.pricingVersionId,"onUpdate:value":f[8]||=e=>Z.pricingVersionId=e,options:N.value,onDropdownVisibleChange:W},null,8,[`value`,`options`])]),_:1})]),_:1}),m(B,{span:12},{default:g(()=>[m(F,{label:`Rider Code`},{default:g(()=>[m(C,{value:Z.riderCode,"onUpdate:value":f[9]||=e=>Z.riderCode=e,options:L.value},null,8,[`value`,`options`])]),_:1})]),_:1})]),_:1}),m(V,{gutter:8},{default:g(()=>[m(B,{span:8},{default:g(()=>[m(F,{label:`Age Min`},{default:g(()=>[m(H,{value:Z.ageMin,"onUpdate:value":f[10]||=e=>Z.ageMin=e,style:{width:`100%`}},null,8,[`value`])]),_:1})]),_:1}),m(B,{span:8},{default:g(()=>[m(F,{label:`Age Max`},{default:g(()=>[m(H,{value:Z.ageMax,"onUpdate:value":f[11]||=e=>Z.ageMax=e,style:{width:`100%`}},null,8,[`value`])]),_:1})]),_:1}),m(B,{span:8},{default:g(()=>[m(F,{label:`Rate /1000`},{default:g(()=>[m(H,{value:Z.ratePer1000,"onUpdate:value":f[12]||=e=>Z.ratePer1000=e,style:{width:`100%`},step:1e-4},null,8,[`value`])]),_:1})]),_:1})]),_:1}),m(V,{gutter:8},{default:g(()=>[m(B,{span:8},{default:g(()=>[m(F,{label:`Rate /Unit`},{default:g(()=>[m(H,{value:Z.ratePerUnit,"onUpdate:value":f[13]||=e=>Z.ratePerUnit=e,style:{width:`100%`},step:1e-4},null,8,[`value`])]),_:1})]),_:1}),m(B,{span:8},{default:g(()=>[m(F,{label:`% Of Base`},{default:g(()=>[m(H,{value:Z.percentOfBase,"onUpdate:value":f[14]||=e=>Z.percentOfBase=e,style:{width:`100%`},step:.01},null,8,[`value`])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,[`visible`,`title`,`confirmLoading`])],64)}}}),[[`__scopeId`,`data-v-8f6448fa`]]);export{j as default};