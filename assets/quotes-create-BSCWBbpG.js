import"./menu-KmJeyBmp.js";import{n as e,t}from"./_plugin-vue_export-helper-DjLyun5i.js";import{a as n,o as r,t as i}from"./input-Dl58X2zG.js";import{t as a}from"./table-B5NlV_bM.js";import{r as o,t as s}from"./select-qwNyy2X6.js";import{o as c}from"./Col-Dn_WxAuq.js";import"./FolderOutlined-CuOYp4hi.js";import"./EyeInvisibleOutlined-DQ7XOaOB.js";import"./move-BV2dG8Yt.js";import"./checkbox-DTOnil2W.js";import{t as l}from"./page-header-oerFmpyY.js";import"./space-BwjoyeVf.js";import"./dropdown-BjYLSNDe.js";import"./breadcrumb-bZrN7p1V.js";import{n as u,t as d}from"./row-DAVpSNuc.js";import"./UpOutlined-CVKY-LmD.js";import{t as f}from"./input-number-Cc1ZCS-y.js";import"./spin-CjGf5sPd.js";import"./ArrowRightOutlined-jL2ruyWB.js";import{Bn as p,Cn as m,Dn as h,En as g,G as _,Gn as ee,Lt as v,Nt as y,Qn as b,Sn as x,Tn as S,Un as C,W as w,Y as T,_n as E,cn as D,ir as O,kn as k,ln as A,on as j,pr as M,rr as N,sn as P,u as F,wn as I,xn as L,z as R}from"./index-DNW3ueIJ.js";import{n as z,r as B,t as V}from"./illustration-B_wBWmkM.js";import{t as H}from"./pricingVersion-CIfy60JL.js";import{t as U}from"./productPlan-zKUpmInK.js";import{t as W}from"./rider-LIyi9SzS.js";var G=e=>{let{componentCls:t,sizePaddingEdgeHorizontal:n,colorSplit:r,lineWidth:i}=e;return{[t]:j(j({},T(e)),{borderBlockStart:`${i}px solid ${r}`,"&-vertical":{position:`relative`,top:`-0.06em`,display:`inline-block`,height:`0.9em`,margin:`0 ${e.dividerVerticalGutterMargin}px`,verticalAlign:`middle`,borderTop:0,borderInlineStart:`${i}px solid ${r}`},"&-horizontal":{display:`flex`,clear:`both`,width:`100%`,minWidth:`100%`,margin:`${e.dividerHorizontalGutterMargin}px 0`},[`&-horizontal${t}-with-text`]:{display:`flex`,alignItems:`center`,margin:`${e.dividerHorizontalWithTextGutterMargin}px 0`,color:e.colorTextHeading,fontWeight:500,fontSize:e.fontSizeLG,whiteSpace:`nowrap`,textAlign:`center`,borderBlockStart:`0 ${r}`,"&::before, &::after":{position:`relative`,width:`50%`,borderBlockStart:`${i}px solid transparent`,borderBlockStartColor:`inherit`,borderBlockEnd:0,transform:`translateY(50%)`,content:`''`}},[`&-horizontal${t}-with-text-left`]:{"&::before":{width:`5%`},"&::after":{width:`95%`}},[`&-horizontal${t}-with-text-right`]:{"&::before":{width:`95%`},"&::after":{width:`5%`}},[`${t}-inner-text`]:{display:`inline-block`,padding:`0 1em`},"&-dashed":{background:`none`,borderColor:r,borderStyle:`dashed`,borderWidth:`${i}px 0 0`},[`&-horizontal${t}-with-text${t}-dashed`]:{"&::before, &::after":{borderStyle:`dashed none none`}},[`&-vertical${t}-dashed`]:{borderInlineStartWidth:i,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},[`&-plain${t}-with-text`]:{color:e.colorText,fontWeight:`normal`,fontSize:e.fontSize},[`&-horizontal${t}-with-text-left${t}-no-default-orientation-margin-left`]:{"&::before":{width:0},"&::after":{width:`100%`},[`${t}-inner-text`]:{paddingInlineStart:n}},[`&-horizontal${t}-with-text-right${t}-no-default-orientation-margin-right`]:{"&::before":{width:`100%`},"&::after":{width:0},[`${t}-inner-text`]:{paddingInlineEnd:n}}})}},K=_(`Divider`,e=>{let t=w(e,{dividerVerticalGutterMargin:e.marginXS,dividerHorizontalWithTextGutterMargin:e.margin,dividerHorizontalGutterMargin:e.marginLG});return[G(t)]},{sizePaddingEdgeHorizontal:0}),q=k({name:`ADivider`,inheritAttrs:!1,compatConfig:{MODE:3},props:(()=>({prefixCls:String,type:{type:String,default:`horizontal`},dashed:{type:Boolean,default:!1},orientation:{type:String,default:`center`},plain:{type:Boolean,default:!1},orientationMargin:[String,Number]}))(),setup(e,t){let{slots:n,attrs:r}=t,{prefixCls:i,direction:a}=R(`divider`,e),[o,s]=K(i),c=L(()=>e.orientation===`left`&&e.orientationMargin!=null),l=L(()=>e.orientation===`right`&&e.orientationMargin!=null),u=L(()=>{let{type:t,dashed:n,plain:r}=e,o=i.value;return{[o]:!0,[s.value]:!!s.value,[`${o}-${t}`]:!0,[`${o}-dashed`]:!!n,[`${o}-plain`]:!!r,[`${o}-rtl`]:a.value===`rtl`,[`${o}-no-default-orientation-margin-left`]:c.value,[`${o}-no-default-orientation-margin-right`]:l.value}}),d=L(()=>{let t=typeof e.orientationMargin==`number`?`${e.orientationMargin}px`:e.orientationMargin;return j(j({},c.value&&{marginLeft:t}),l.value&&{marginRight:t})}),f=L(()=>e.orientation.length>0?`-`+e.orientation:e.orientation);return()=>{let e=v(n.default?.call(n));return o(h(`div`,P(P({},r),{},{class:[u.value,e.length?`${i.value}-with-text ${i.value}-with-text${f.value}`:``,r.class],role:`separator`}),[e.length?h(`span`,{class:`${i.value}-inner-text`,style:d.value},[e]):null]))}}}),te=y(q),ne={style:{display:`flex`,gap:`12px`,"margin-top":`16px`}},J=t(k({__name:`index`,setup(t){let _=O(!1),v=A(),y=D();function w(){v.back()}let T=O(!1),k=O(!1),j=O(!1),P=O(!1),L=O(!1),R=O(null),G=O([]),K=O([]),q=O([]),J=O([]),Y=O([]),X=N({appId:y.query.appId?String(y.query.appId):void 0,planId:``,pricingVersionId:``,mode:`MONTHLY`,sumAssured:1e7,termYears:null,termMonths:null,insuredAge:30,insuredSex:`M`,insuredSmoker:!1,riders:[],note:``}),re=[{title:`Rider`,dataIndex:`riderCode`,key:`riderCode`},{title:`Units/SA`,dataIndex:`units`,key:`units`},{title:`Premium`,dataIndex:`premium`,key:`premium`}],ie=[{title:`Policy Year`,dataIndex:`policyYear`,key:`policyYear`},{title:`Premium Annual`,dataIndex:`premiumAnnual`,key:`premiumAnnual`},{title:`GCV`,dataIndex:`gcv`,key:`gcv`},{title:`Surrender Value`,dataIndex:`surrenderValue`,key:`surrenderValue`},{title:`Death Benefit`,dataIndex:`deathBenefit`,key:`deathBenefit`}];function Z(e,t){return(t?.label??``).toLowerCase().includes((e||``).toLowerCase())}async function Q(){k.value=!0;try{let e=await U.getAll({page:1,pageSize:500})??[],t=e.data??e??[];q.value=(Array.isArray(t)?t:t.items??t.Items??[]).map(e=>({label:e.planId??e.name,value:e.planId}))}catch(e){console.error(e)}finally{k.value=!1}}async function $(e=!0){if(!(!e||!X.planId)){j.value=!0;try{let e=await H.getAll(X.planId)??[],t=e.data??e??[];J.value=(Array.isArray(t)?t:t.items??t.Items??[]).map(e=>({label:e.pricingVersionId??e.name,value:e.pricingVersionId}))}catch(e){console.error(e)}finally{j.value=!1}}}async function ae(e=!0){if(e){P.value=!0;try{let e=await W.queryMasters(),t=e.data??e??[];Y.value=(Array.isArray(t)?t:[]).map(e=>({label:`${e.name} (${e.riderCode})`,value:e.riderCode}))}catch(e){console.error(e)}finally{P.value=!1}}}async function oe(e=!0){if(e){L.value=!0;try{let e=await B.getAll({page:1,pageSize:200})??[],t=e.data??e??[];K.value=(Array.isArray(t)?t:t.items??t.Items??[]).map(e=>({label:`${e?.lead?.fullName??e.appId}`,value:e.appId}))}catch(e){console.error(e)}finally{L.value=!1}}}function se(){X.riders.push({riderCode:``,riderSaOrUnits:0,units:0})}function ce(e){X.riders.splice(e,1)}function le(){X.planId=``,X.pricingVersionId=``,X.mode=`MONTHLY`,X.sumAssured=1e7,X.termYears=null,X.termMonths=null,X.insuredAge=30,X.insuredSex=`M`,X.insuredSmoker=!1,X.riders=[],X.note=``,R.value=null,G.value=[]}async function ue(){if(!X.planId||!X.pricingVersionId){F.warn(`Choose plan and pricing version`);return}T.value=!0;try{let e={appId:X.appId??null,planId:X.planId,pricingVersionId:X.pricingVersionId,mode:X.mode,sumAssured:Number(X.sumAssured),termYears:X.termYears??void 0,termMonths:X.termMonths??void 0,insuredAge:Number(X.insuredAge),insuredSex:X.insuredSex,insuredSmoker:!!X.insuredSmoker,riders:X.riders?.filter(e=>e.riderCode).map(e=>({riderCode:e.riderCode,riderSaOrUnits:Number(e.riderSaOrUnits||0),units:Number(e.units||0)}))??[]},t=await z.create(e);if(R.value=t.data??t??null,F.success(`Quote created`),R.value?.illustrationId){let e=await V.getDetail(R.value.illustrationId),t=e.data??e??{};G.value=t.illuYearlies??t.IlluYearlies??t.illuyearlies??[]}}catch(e){console.error(e),F.error(`Create quote failed`)}finally{T.value=!1}}function de(e){if(!e)return null;let t=/filename\*?=(?:UTF-8'')?["']?([^;"']+)["']?/i.exec(e);if(!t)return null;try{return decodeURIComponent(t[1].replace(/['"]/g,``))}catch{return t[1].replace(/['"]/g,``)}}async function fe(){if(!R.value?.illustrationId){F.warn(`No PDF`);return}_.value=!0;try{let e=await V.getPdf(R.value.illustrationId),t,n=`illustration-${R.value.illustrationId}.pdf`;if(e&&typeof e==`object`&&`data`in e){t=e.data instanceof Blob?e.data:new Blob([e.data],{type:`application/pdf`});let r=(e.headers&&(e.headers[`content-disposition`]||e.headers[`Content-Disposition`]))??null;n=de(r)??n}else if(e&&typeof e.blob==`function`){t=await e.blob();let r=e.headers?.get?.(`content-disposition`)??null;n=de(r)??n}else t=e instanceof Blob?e:new Blob([JSON.stringify(e)],{type:`application/pdf`});let r=window.URL.createObjectURL(t),i=document.createElement(`a`);i.href=r,i.download=n,document.body.appendChild(i),i.click(),i.remove(),window.URL.revokeObjectURL(r),F.success(`Download started`)}catch(e){console.error(e),F.error(e?.message??`Download failed`)}finally{_.value=!1}}return p(()=>{Q(),$(),ae()}),(t,p)=>{let v=l,y=o,D=r,O=u,A=d,N=s,F=f,z=i,B=te,V=e,H=n,U=c,W=a;return C(),S(E,null,[h(v,{title:`Create Quote`,onBack:w}),h(U,{class:`mb16`},{default:b(()=>[h(H,{layout:`vertical`},{default:b(()=>[h(A,{gutter:12},{default:b(()=>[h(O,{span:8},{default:b(()=>[h(D,{label:`Application`},{default:b(()=>[h(y,{value:X.appId,"onUpdate:value":p[0]||=e=>X.appId=e,options:K.value,"show-search":``,allowClear:``,placeholder:`Select application`,onDropdownVisibleChange:oe,loading:L.value,filterOption:Z},null,8,[`value`,`options`,`loading`])]),_:1})]),_:1}),h(O,{span:8},{default:b(()=>[h(D,{label:`Product (Plan)`},{default:b(()=>[h(y,{value:X.planId,"onUpdate:value":p[1]||=e=>X.planId=e,options:q.value,"show-search":``,allowClear:``,placeholder:`Select plan`,onDropdownVisibleChange:Q,loading:k.value,filterOption:Z},null,8,[`value`,`options`,`loading`])]),_:1})]),_:1}),h(O,{span:8},{default:b(()=>[h(D,{label:`Pricing Version`},{default:b(()=>[h(y,{value:X.pricingVersionId,"onUpdate:value":p[2]||=e=>X.pricingVersionId=e,options:J.value,"show-search":``,allowClear:``,placeholder:`Select pricing version`,onDropdownVisibleChange:$,loading:j.value,filterOption:Z},null,8,[`value`,`options`,`loading`])]),_:1})]),_:1})]),_:1}),h(A,{gutter:12},{default:b(()=>[h(O,{span:6},{default:b(()=>[h(D,{label:`Mode`},{default:b(()=>[h(y,{value:X.mode,"onUpdate:value":p[3]||=e=>X.mode=e},{default:b(()=>[h(N,{value:`MONTHLY`},{default:b(()=>[...p[10]||=[g(`MONTHLY`,-1)]]),_:1}),h(N,{value:`ONE_TIME`},{default:b(()=>[...p[11]||=[g(`ONE_TIME`,-1)]]),_:1})]),_:1},8,[`value`])]),_:1})]),_:1}),h(O,{span:6},{default:b(()=>[h(D,{label:`Sum Assured`},{default:b(()=>[h(F,{value:X.sumAssured,"onUpdate:value":p[4]||=e=>X.sumAssured=e,style:{width:`100%`},step:1e3},null,8,[`value`])]),_:1})]),_:1}),h(O,{span:6},{default:b(()=>[h(D,{label:`Term Months`},{default:b(()=>[h(F,{value:X.termMonths,"onUpdate:value":p[5]||=e=>X.termMonths=e,style:{width:`100%`},min:0},null,8,[`value`])]),_:1})]),_:1})]),_:1}),h(A,{gutter:12},{default:b(()=>[h(O,{span:4},{default:b(()=>[h(D,{label:`Insured Age`},{default:b(()=>[h(F,{value:X.insuredAge,"onUpdate:value":p[6]||=e=>X.insuredAge=e,style:{width:`100%`}},null,8,[`value`])]),_:1})]),_:1}),h(O,{span:4},{default:b(()=>[h(D,{label:`Sex`},{default:b(()=>[h(y,{value:X.insuredSex,"onUpdate:value":p[7]||=e=>X.insuredSex=e},{default:b(()=>[h(N,{value:`M`},{default:b(()=>[...p[12]||=[g(`M`,-1)]]),_:1}),h(N,{value:`F`},{default:b(()=>[...p[13]||=[g(`F`,-1)]]),_:1})]),_:1},8,[`value`])]),_:1})]),_:1}),h(O,{span:4},{default:b(()=>[h(D,{label:`Smoker`},{default:b(()=>[h(y,{value:X.insuredSmoker,"onUpdate:value":p[8]||=e=>X.insuredSmoker=e},{default:b(()=>[h(N,{value:!1},{default:b(()=>[...p[14]||=[g(`No`,-1)]]),_:1}),h(N,{value:!0},{default:b(()=>[...p[15]||=[g(`Yes`,-1)]]),_:1})]),_:1},8,[`value`])]),_:1})]),_:1}),h(O,{span:12},{default:b(()=>[h(D,{label:`Reference / Note`},{default:b(()=>[h(z,{value:X.note,"onUpdate:value":p[9]||=e=>X.note=e},null,8,[`value`])]),_:1})]),_:1})]),_:1}),h(B,null,{default:b(()=>[...p[16]||=[g(`Riders (Optional)`,-1)]]),_:1}),(C(!0),S(E,null,ee(X.riders,(e,t)=>(C(),S(`div`,{key:t,style:{display:`flex`,gap:`8px`,"margin-bottom":`8px`}},[h(y,{value:e.riderCode,"onUpdate:value":t=>e.riderCode=t,options:Y.value,placeholder:`Rider`,style:{width:`260px`},onDropdownVisibleChange:ae,loading:P.value,filterOption:Z},null,8,[`value`,`onUpdate:value`,`options`,`loading`]),h(F,{value:e.riderSaOrUnits,"onUpdate:value":t=>e.riderSaOrUnits=t,placeholder:`SA / Units`,style:{width:`180px`},step:1e3},null,8,[`value`,`onUpdate:value`]),h(F,{value:e.units,"onUpdate:value":t=>e.units=t,placeholder:`Units`,style:{width:`120px`}},null,8,[`value`,`onUpdate:value`]),h(V,{danger:``,onClick:e=>ce(t)},{default:b(()=>[...p[17]||=[g(`Remove`,-1)]]),_:1},8,[`onClick`])]))),128)),h(V,{type:`dashed`,block:``,onClick:se},{default:b(()=>[...p[18]||=[g(`+ Add Rider`,-1)]]),_:1}),x(`div`,ne,[h(V,{type:`primary`,loading:T.value,onClick:ue},{default:b(()=>[...p[19]||=[g(`Create Quote`,-1)]]),_:1},8,[`loading`]),h(V,{onClick:le},{default:b(()=>[...p[20]||=[g(`Reset`,-1)]]),_:1})])]),_:1})]),_:1}),R.value?(C(),m(U,{key:0,title:`Quote Result`,class:`mb16`},{default:b(()=>[h(A,{gutter:12},{default:b(()=>[h(O,{span:8},{default:b(()=>[p[21]||=x(`b`,null,`Total Premium`,-1),x(`div`,null,M(R.value.totalPremium),1)]),_:1}),h(O,{span:8},{default:b(()=>[p[22]||=x(`b`,null,`Base`,-1),x(`div`,null,M(R.value.breakdownBase),1)]),_:1}),h(O,{span:8},{default:b(()=>[p[23]||=x(`b`,null,`Riders`,-1),x(`div`,null,M(R.value.breakdownRiders),1)]),_:1})]),_:1}),h(W,{columns:re,dataSource:R.value.riders||[],pagination:!1,rowKey:`riderCode`,class:`mt12`},null,8,[`dataSource`]),R.value.pdfUri?(C(),m(V,{key:0,type:`link`,onClick:fe,loading:_.value},{default:b(()=>[...p[24]||=[g(`Download Illustration`,-1)]]),_:1},8,[`loading`])):I(``,!0)]),_:1})):I(``,!0),G.value.length?(C(),m(U,{key:1,title:`Illustration (yearly)`},{default:b(()=>[h(W,{columns:ie,dataSource:G.value,pagination:!1,rowKey:`policyYear`},null,8,[`dataSource`])]),_:1})):I(``,!0)],64)}}}),[[`__scopeId`,`data-v-6f70031f`]]);export{J as default};