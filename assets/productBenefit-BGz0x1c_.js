import"./EyeInvisibleOutlined-vBZdbnb5.js";import{n as e,t}from"./_plugin-vue_export-helper-CCMMWqEJ.js";import{a as n,i as r,o as i,r as a,t as o}from"./input-CE70cYGf.js";import{t as s}from"./table-Bj7AWOqL.js";import{r as c,t as l}from"./select-BktQDR1e.js";import{o as u}from"./Col-B88sKFw0.js";import"./FolderOutlined-v8Whbuap.js";import{t as d}from"./modal-DoGUrgx-.js";import"./checkbox-o3cgUXip.js";import{t as f}from"./space-CGZIuoRS.js";import"./dropdown-kgT51ow1.js";import"./UpOutlined-ZUi5vTGj.js";import{t as p}from"./input-number-Jr8dvtpE.js";import"./spin-D756cOu2.js";import{t as m}from"./popconfirm-Cd8ZXcgh.js";import{Dn as h,En as g,Nn as _,Rn as v,Sn as y,Tn as b,Vn as x,Wn as S,Xn as C,bn as w,cn as T,cr as E,dr as D,l as O,nr as k,wn as A,xn as j}from"./index-DYE8AE99.js";import{t as M}from"./productBenefit-DudPGPK-.js";const N=[{title:`No`,dataIndex:`index`,key:`index`,width:80},{title:`Benefit Id`,dataIndex:`benefitId`,key:`benefitId`,width:220,sorter:!0},{title:`Benefit Code`,dataIndex:`benefitCode`,key:`benefitCode`,width:180},{title:`Benefit Name`,dataIndex:`benefitName`,key:`benefitName`,width:320},{title:`Benefit Type`,dataIndex:`benefitType`,key:`benefitType`,width:160},{title:`Plan Id`,dataIndex:`planId`,key:`planId`,width:180},{title:`Action`,key:`action`,fixed:`right`,width:180}];var P={class:`product-benefit-page`},F={class:`title`},ee={style:{display:`flex`,gap:`12px`,"align-items":`center`,"margin-bottom":`8px`}},te={key:1},I=t(h({__name:`index`,props:{planId:{}},setup(t){let h=T(),I=t.planId??``,L=k(``),R=k(!1),z=k(!1),B=k(!1),V=k(!1),H=k(null),U=k(1),W=k(20),G=k(0),K=k([]),q=k([]),J={benefitId:``,benefitCode:``,benefitName:``,benefitType:`LIFE`,payableEvent:`DEATH`,limitAmount:void 0,calculationBasis:``,notes:``},Y=k({...J}),X=k(),Z=N,ne=w(()=>({current:U.value,pageSize:W.value,total:G.value,showSizeChanger:!0,showQuickJumper:!0})),re=e=>e.benefitId,ie=w(()=>K.value.map((e,t)=>({...e,index:(U.value-1)*W.value+t+1}))),ae=w(()=>({selectedRowKeys:q.value,onChange:e=>{q.value=e.slice()}})),oe={benefitId:[{required:!0,message:`BenefitId required`,trigger:`blur`}],benefitCode:[{required:!0,message:`Benefit code required`,trigger:`blur`}],benefitName:[{required:!0,message:`Benefit name required`,trigger:`blur`}]};async function Q(){R.value=!0;try{let e=await M.getAll(I),t=e.data??e??[];K.value=Array.from(t),G.value=K.value.length}catch(e){console.error(e),O.error(`Load product benefits failed`)}finally{R.value=!1}}let $=async()=>{U.value=1,await Q()},se=async e=>{e&&(U.value=e.current||U.value,W.value=e.pageSize||W.value),await Q()},ce=async()=>{V.value=!1,H.value=null,Object.assign(Y.value,JSON.parse(JSON.stringify(J))),B.value=!0,await _(),X.value?.resetFields?.(JSON.parse(JSON.stringify(J))),X.value?.clearValidate?.()};async function le(e){V.value=!0,H.value=e.benefitId;try{let t=await M.getDetail(I,e.benefitId),n=t.data??t;Object.assign(Y.value,{benefitId:n.benefitId,benefitCode:n.benefitCode,benefitName:n.benefitName,benefitType:n.benefitType,payableEvent:n.payableEvent,limitAmount:n.limitAmount??void 0,calculationBasis:n.calculationBasis??``,notes:n.notes??``}),B.value=!0,await _(),X.value?.clearValidate?.()}catch(e){console.error(e),O.error(`Load benefit detail failed`)}}async function ue(e){d.confirm({title:`Delete benefit`,content:`Delete benefit ${e.benefitId}?`,onOk:async()=>{try{await M.remove(I,e.benefitId),O.success(`Deleted`),q.value=q.value.filter(t=>t!==e.benefitId),Q()}catch(e){console.error(e),O.error(`Delete failed`)}}})}function de(e){h.push({name:`ProductBenefitDetail`,params:{planId:I,benefitId:e.benefitId}}).catch(()=>{})}let fe=async()=>{q.value.length&&d.confirm({title:`Delete ${q.value.length} benefit(s)`,content:`Are you sure to delete selected benefits?`,onOk:async()=>{try{for(let e of[...q.value])await M.remove(I,e);O.success(`Deleted selected`),q.value=[],U.value=1,Q()}catch(e){console.error(e),O.error(`Delete failed`)}}})},pe=async()=>{try{await X.value?.validate?.()}catch{return}let e={benefitId:(Y.value.benefitId??``).trim(),benefitCode:(Y.value.benefitCode??``).trim(),benefitName:(Y.value.benefitName??``).trim(),benefitType:Y.value.benefitType??``,payableEvent:Y.value.payableEvent??``,limitAmount:Y.value.limitAmount??null,calculationBasis:Y.value.calculationBasis??null,notes:Y.value.notes??null},t={benefitCode:(Y.value.benefitCode??``).trim(),benefitName:(Y.value.benefitName??``).trim(),benefitType:Y.value.benefitType??null,payableEvent:Y.value.payableEvent??null,limitAmount:Y.value.limitAmount??null,calculationBasis:Y.value.calculationBasis??null,notes:Y.value.notes??null};z.value=!0;try{V.value&&H.value?(await M.update(I,H.value,t),O.success(`Updated`)):(await M.create(I,e),O.success(`Created`)),B.value=!1,q.value=[],await Q()}catch(e){console.error(e),O.error(String(e?.response?.data?.message??`Save failed`))}finally{z.value=!1}},me=()=>{B.value=!1};return v(async()=>{await Q()}),(t,h)=>{let _=r,v=e,w=m,T=f,O=s,k=u,M=o,N=i,H=l,U=c,W=p,G=a,K=n,J=d,he=S(`router-view`);return x(),y(he,null,{default:C(({route:e})=>[j(`div`,P,[j(`h2`,F,`Product Benefits for `+D(E(I)),1),g(k,{class:`mb16`,"body-style":{padding:`12px`}},{default:C(()=>[j(`div`,ee,[g(_,{value:L.value,"onUpdate:value":h[0]||=e=>L.value=e,placeholder:`Search by code or name`,onSearch:$,style:{width:`360px`},allowClear:``},null,8,[`value`]),g(v,{type:`primary`,onClick:ce},{default:C(()=>[...h[10]||=[b(`Create Benefit`,-1)]]),_:1}),g(v,{danger:``,disabled:!q.value.length,onClick:fe},{default:C(()=>[...h[11]||=[b(`Delete Selected`,-1)]]),_:1},8,[`disabled`]),g(v,{loading:R.value,onClick:Q},{default:C(()=>[...h[12]||=[b(`Refresh`,-1)]]),_:1},8,[`loading`])]),g(O,{columns:E(Z),dataSource:ie.value,loading:R.value,pagination:ne.value,rowKey:re,rowSelection:ae.value,scroll:{x:1200},onChange:se},{bodyCell:C(({column:e,record:t})=>[e.key===`action`?(x(),y(T,{key:0,style:{"justify-content":`flex-end`,width:`100%`}},{default:C(()=>[g(v,{size:`small`,onClick:()=>de(t)},{default:C(()=>[...h[13]||=[b(`View`,-1)]]),_:1},8,[`onClick`]),g(v,{size:`small`,type:`primary`,onClick:()=>le(t)},{default:C(()=>[...h[14]||=[b(`Edit`,-1)]]),_:1},8,[`onClick`]),g(w,{placement:`bottom`,title:`Delete this benefit?`,onConfirm:()=>ue(t)},{default:C(()=>[g(v,{size:`small`,danger:``},{default:C(()=>[...h[15]||=[b(`Delete`,-1)]]),_:1})]),_:1},8,[`onConfirm`])]),_:2},1024)):(x(),A(`span`,te,D(t[e.dataIndex]),1))]),_:1},8,[`columns`,`dataSource`,`loading`,`pagination`,`rowSelection`])]),_:1}),g(J,{open:B.value,"onUpdate:open":h[9]||=e=>B.value=e,title:V.value?`Edit Benefit`:`Create Benefit`,onOk:pe,onCancel:me,confirmLoading:z.value,width:760,centered:``},{default:C(()=>[g(K,{ref_key:`formRef`,ref:X,model:Y.value,rules:oe,layout:`vertical`},{default:C(()=>[g(N,{label:`Benefit Id`,name:`benefitId`,rules:V.value?[]:[{required:!0,message:`BenefitId required`}]},{default:C(()=>[g(M,{value:Y.value.benefitId,"onUpdate:value":h[1]||=e=>Y.value.benefitId=e,disabled:V.value,placeholder:`Unique id`},null,8,[`value`,`disabled`])]),_:1},8,[`rules`]),g(N,{label:`Benefit Code`,name:`benefitCode`,rules:[{required:!0,message:`Benefit code required`}]},{default:C(()=>[g(M,{value:Y.value.benefitCode,"onUpdate:value":h[2]||=e=>Y.value.benefitCode=e,placeholder:`e.g. BFT001`},null,8,[`value`])]),_:1}),g(N,{label:`Benefit Name`,name:`benefitName`,rules:[{required:!0,message:`Benefit name required`}]},{default:C(()=>[g(M,{value:Y.value.benefitName,"onUpdate:value":h[3]||=e=>Y.value.benefitName=e,placeholder:`Benefit display name`},null,8,[`value`])]),_:1}),g(N,{label:`Benefit Type`,name:`benefitType`},{default:C(()=>[g(U,{value:Y.value.benefitType,"onUpdate:value":h[4]||=e=>Y.value.benefitType=e,placeholder:`Select type`},{default:C(()=>[g(H,{value:`MAIN`},{default:C(()=>[...h[16]||=[b(`MAIN`,-1)]]),_:1}),g(H,{value:`LIFE`},{default:C(()=>[...h[17]||=[b(`LIFE`,-1)]]),_:1}),g(H,{value:`HEALTH`},{default:C(()=>[...h[18]||=[b(`HEALTH`,-1)]]),_:1}),g(H,{value:`RIDER`},{default:C(()=>[...h[19]||=[b(`RIDER`,-1)]]),_:1})]),_:1},8,[`value`])]),_:1}),g(N,{label:`Payable Event`,name:`payableEvent`},{default:C(()=>[g(U,{value:Y.value.payableEvent,"onUpdate:value":h[5]||=e=>Y.value.payableEvent=e,placeholder:`Select event`},{default:C(()=>[g(H,{value:`DEATH`},{default:C(()=>[...h[20]||=[b(`DEATH`,-1)]]),_:1}),g(H,{value:`MATURITY`},{default:C(()=>[...h[21]||=[b(`MATURITY`,-1)]]),_:1}),g(H,{value:`CRITICAL_ILLNESS`},{default:C(()=>[...h[22]||=[b(`CRITICAL_ILLNESS`,-1)]]),_:1})]),_:1},8,[`value`])]),_:1}),g(N,{label:`Limit Amount`,name:`limitAmount`},{default:C(()=>[g(W,{value:Y.value.limitAmount,"onUpdate:value":h[6]||=e=>Y.value.limitAmount=e,style:{width:`100%`}},null,8,[`value`])]),_:1}),g(N,{label:`Calculation Basis`,name:`calculationBasis`},{default:C(()=>[g(M,{value:Y.value.calculationBasis,"onUpdate:value":h[7]||=e=>Y.value.calculationBasis=e,placeholder:`formula or basis`},null,8,[`value`])]),_:1}),g(N,{label:`Notes`,name:`notes`},{default:C(()=>[g(G,{value:Y.value.notes,"onUpdate:value":h[8]||=e=>Y.value.notes=e,rows:3},null,8,[`value`])]),_:1})]),_:1},8,[`model`])]),_:1},8,[`open`,`title`,`confirmLoading`])])]),_:1})}}}),[[`__scopeId`,`data-v-c12beb6a`]]);export{I as default};