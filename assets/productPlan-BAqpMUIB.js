import{a as e,u as t}from"./EyeInvisibleOutlined-vBZdbnb5.js";import{n,t as r}from"./_plugin-vue_export-helper-CCMMWqEJ.js";import{a as i,i as a,l as o,o as ee,t as te}from"./input-CE70cYGf.js";import{i as ne,t as s}from"./table-Bj7AWOqL.js";import{r as c,t as l}from"./select-BktQDR1e.js";import{o as u}from"./Col-B88sKFw0.js";import"./FolderOutlined-v8Whbuap.js";import{t as d}from"./modal-DoGUrgx-.js";import"./checkbox-o3cgUXip.js";import"./dropdown-kgT51ow1.js";import"./SwapRightOutlined-B30FF2QO.js";import"./es-1eb-LgCN.js";import"./UpOutlined-ZUi5vTGj.js";import"./spin-D756cOu2.js";import"./ArrowRightOutlined-BTInphOv.js";import{Dn as f,En as p,Kn as re,Nn as m,Sn as h,Tn as g,Un as ie,Vn as _,Wn as v,Xn as y,bn as b,cn as x,cr as S,dr as C,gn as w,kn as T,l as E,mn as D,nr as O,ur as ae,wn as k,xn as A}from"./index-DYE8AE99.js";import{t as oe}from"./Icon-wKyRgJuN.js";import{t as j}from"./productPlan-DbpaFBUo.js";const M=[{title:`No`,dataIndex:`index`,key:`index`,width:80},{title:`Plan Id`,dataIndex:`planId`,key:`planId`,width:240,sorter:!1,sortDirections:[`ascend`,`descend`]},{title:`Product Type`,dataIndex:`productType`,key:`productType`,width:160,sorter:!1,sortDirections:[`ascend`,`descend`]},{title:`Name`,dataIndex:`name`,key:`name`,width:320,sorter:!1,sortDirections:[`ascend`,`descend`]},{title:`Currency`,dataIndex:`currency`,key:`currency`,width:120,sorter:!1,sortDirections:[`ascend`,`descend`],customRender:({text:e})=>T(`span`,e??`VND`)},{title:`Action`,key:`action`,fixed:`right`,width:160}];var se={key:1,class:`product-plan-page`},ce={style:{display:`flex`,gap:`12px`,"align-items":`center`,"margin-bottom":`8px`}},le={key:0},ue=[`onClick`,`type`],N={key:1},P=r(f({__name:`index`,setup(r){let f=x(),T=O(``),P=O(!1),F=O(!1),I=O(!1),L=O(!1),R=O(null),z=O(1),B=O(20),V=O(0),H=O([]),U=O([]),W={planId:``,productType:``,name:``,currency:`VND`},G=O({...W}),K=O(),de=M,fe=b(()=>({current:z.value,pageSize:B.value,total:V.value,showSizeChanger:!0,showQuickJumper:!0})),pe=e=>e.planId;function q(e){f.push({name:`ProductBenefits`,params:{planId:e.planId}})}function J(e){f.push({name:`PricingVersions`,params:{planId:e.planId}})}async function Y(e){await f.push({name:`PlanVersions`,params:{planId:e.planId}})}let me=b(()=>H.value.map((e,t)=>({...e,index:(z.value-1)*B.value+t+1,__onEdit:Q,__onDelete:$,__onManagerPlanVersion:Y,__onManagePricingVersions:J,__onManageProductBenefits:q}))),he={productType:[{required:!0,message:`ProductType required`,trigger:`blur`}],name:[{required:!0,message:`Name required`,trigger:`blur`}]},ge=b(()=>({selectedRowKeys:U.value,onChange:(e,t)=>{U.value=e.slice()}}));function _e(e){return e.key===`edit`?`EditOutlined`:e.key===`delete`?`DeleteOutlined`:e.key===`planVersion`?`ProfileOutlined`:e.key===`pricingVersion`?`DatabaseOutlined`:`AppstoreOutlined`}function ve(e,t){return typeof e.label==`function`?e.label(t):e.label}function ye(e){return[{key:`edit`,label:`Edit`,type:`default`,permission:!0,enable:!0,onClick:Q},{key:`delete`,label:`Delete`,type:`danger`,permission:!0,enable:!0,onClick:$},{key:`planVersion`,label:`Plan Version`,type:`default`,permission:!0,enable:!0,onClick:Y},{key:`pricingVersion`,label:`Pricing Version`,type:`default`,permission:!0,enable:!0,onClick:J},{key:`productBenefit`,label:`Product Benefit`,type:`default`,permission:!0,enable:!0,onClick:q}]}function be(e,t){try{e.domEvent?.stopPropagation?.();let n=e.key;if(n===`edit`)return X(t,`__onEdit`);if(n===`delete`)return X(t,`__onDelete`);if(n===`view`)return X(t,`__onView`)}catch(e){console.error(`onMenuClickWithRecord error`,e),E.error(`Action failed`)}}function X(e,t){try{let n=e?.[t];if(typeof n==`function`)return n(e);console.warn(`${t} is not a function on record`,e)}catch(e){console.error(`safeCall error`,e)}}let Z=async()=>{P.value=!0;try{let e={page:z.value,pageSize:B.value,q:T.value||void 0},t=await j.getAll(e),n=t.data??t;H.value=Array.from(n.items??n.items??[]),V.value=n.totalItems??n.totalItems??0}catch(e){console.error(e),E.error(`Load product plans failed`)}finally{P.value=!1}},xe=async()=>{z.value=1,await Z()},Se=async e=>{e&&(z.value=e.current||z.value,B.value=e.pageSize||B.value),await Z()},Ce=async()=>{L.value=!1,R.value=null,Object.assign(G.value,o(W)),I.value=!0,await m(),K.value?.resetFields?.(o(W)),K.value?.clearValidate?.(),await m()};async function Q(e){L.value=!0,R.value=e.planId;try{let t=await j.getDetail(e.planId),n=t.data??t;Object.assign(G.value,{planId:n.planId,productType:n.productType,name:n.name,currency:n.currency??`VND`}),I.value=!0,await m(),K.value?.clearValidate?.()}catch(e){console.error(e),E.error(`Load plan detail failed`)}}async function $(e){d.confirm({title:`Delete product plan`,content:`Delete plan ${e.planId}?`,onOk:async()=>{try{await j.remove(e.planId),E.success(`Deleted`),U.value=U.value.filter(t=>t!==e.planId),Z()}catch(e){console.error(e),E.error(`Delete failed`)}}})}let we=async()=>{U.value.length&&d.confirm({title:`Delete ${U.value.length} product plan(s)`,content:`Are you sure to delete selected plans?`,onOk:async()=>{try{for(let e of[...U.value])await j.remove(e);E.success(`Deleted selected plans`)}catch(e){console.error(e),E.error(`Delete failed`)}finally{U.value=[],z.value=1,Z()}}})},Te=async()=>{try{await K.value?.validate?.()}catch{return}let e={planId:(G.value.planId??``).trim(),productType:(G.value.productType??``).trim(),name:(G.value.name??``).trim(),currency:G.value.currency??`VND`},t={productType:(G.value.productType??``).trim(),name:(G.value.name??``).trim(),currency:G.value.currency??`VND`};F.value=!0;try{L.value&&R.value?(await j.update(R.value,t),E.success(`Updated`)):(await j.create(e),E.success(`Created`)),I.value=!1,U.value=[],Z()}catch(e){console.error(e);let t=e?.response?.data?.error??e?.response?.data??`Save failed`;E.error(String(t))}finally{F.value=!1}},Ee=()=>{I.value=!1};return Z(),(r,o)=>{let f=a,m=n,b=oe,x=t,E=e,O=ne,j=s,M=u,R=te,z=ee,B=l,V=c,H=i,W=d,q=v(`router-view`);return _(),h(q,null,{default:y(({Component:e})=>[e?(_(),h(re(e),{key:0})):(_(),k(`div`,se,[o[17]||=A(`h2`,{class:`title`},`Sản phẩm bảo hiểm`,-1),p(M,{class:`mb16`,"body-style":{padding:`12px`}},{default:y(()=>[A(`div`,ce,[p(f,{value:T.value,"onUpdate:value":o[0]||=e=>T.value=e,placeholder:`Search by PlanId or Name`,onSearch:xe,style:{width:`360px`},allowClear:``},null,8,[`value`]),p(m,{type:`primary`,onClick:Ce},{default:y(()=>[...o[8]||=[g(`Create Plan`,-1)]]),_:1}),p(m,{danger:``,disabled:!U.value.length,onClick:we},{default:y(()=>[...o[9]||=[g(`Delete Selected`,-1)]]),_:1},8,[`disabled`]),p(m,{loading:P.value,onClick:Z},{default:y(()=>[...o[10]||=[g(`Refresh`,-1)]]),_:1},8,[`loading`])]),p(j,{columns:S(de),dataSource:me.value,loading:P.value,pagination:fe.value,rowKey:pe,rowSelection:ge.value,scroll:{x:1e3},onChange:Se},{bodyCell:y(({column:e,record:t})=>[e.key===`action`?(_(),h(O,{key:0,placement:`topLeft`,trigger:`click`},{overlay:y(()=>[p(E,{class:`menu-box`,onClick:o[1]||=()=>be},{default:y(()=>[(_(!0),k(w,null,ie(ye(t),(e,n)=>(_(),h(x,{key:`${n}-${e.label}`,style:ae({color:e.type===`delete`?`red`:`inherit`})},{icon:y(()=>[p(b,{align:`2px`,size:`15px`,style:{"margin-right":`12px`},type:_e(e)},null,8,[`type`])]),default:y(()=>[e.permission===!1?(_(),k(`span`,le,`——`)):(_(),k(`a`,{key:1,onClick:()=>e.onClick?.(t),type:e.type},C(ve(e,t)),9,ue))]),_:2},1032,[`style`]))),128))]),_:2},1024)]),default:y(()=>[A(`span`,{class:`ant-dropdown-link`,role:`button`,tabindex:`0`,onClick:o[2]||=D(()=>{},[`prevent`])},[p(b,{align:`2px`,size:`20px`,style:{"margin-left":`5px`},type:`EllipsisOutlined`})])]),_:2},1024)):(_(),k(`span`,N,C(t[e.dataIndex]),1))]),_:1},8,[`columns`,`dataSource`,`loading`,`pagination`,`rowSelection`])]),_:1}),p(W,{open:I.value,"onUpdate:open":o[7]||=e=>I.value=e,title:L.value?`Edit Product Plan`:`Create Product Plan`,onOk:Te,onCancel:Ee,confirmLoading:F.value,width:680,centered:``},{default:y(()=>[p(H,{ref_key:`formRef`,ref:K,model:G.value,rules:he,layout:`vertical`},{default:y(()=>[p(z,{label:`Plan Id`,name:`planId`,rules:L.value?[]:[{required:!0,message:`PlanId is required`}]},{default:y(()=>[p(R,{value:G.value.planId,"onUpdate:value":o[3]||=e=>G.value.planId=e,disabled:L.value,placeholder:`e.g. MAPLIFE_TERM_20`},null,8,[`value`,`disabled`])]),_:1},8,[`rules`]),p(z,{label:`Product Type`,name:`productType`,rules:[{required:!0,message:`ProductType required`}]},{default:y(()=>[p(V,{value:G.value.productType,"onUpdate:value":o[4]||=e=>G.value.productType=e,style:{width:`100%`}},{default:y(()=>[p(B,{value:`TERM`},{default:y(()=>[...o[11]||=[g(`TERM LIFE`,-1)]]),_:1}),p(B,{value:`WHOLE_LIFE`},{default:y(()=>[...o[12]||=[g(`WHOLE_LIFE`,-1)]]),_:1}),p(B,{value:`UNIVER_LIFE`},{default:y(()=>[...o[13]||=[g(`UNIVER_LIFE`,-1)]]),_:1})]),_:1},8,[`value`])]),_:1}),p(z,{label:`Name`,name:`name`,rules:[{required:!0,message:`Name required`}]},{default:y(()=>[p(R,{value:G.value.name,"onUpdate:value":o[5]||=e=>G.value.name=e,placeholder:`Product name`},null,8,[`value`])]),_:1}),p(z,{label:`Currency`,name:`currency`},{default:y(()=>[p(V,{value:G.value.currency,"onUpdate:value":o[6]||=e=>G.value.currency=e,style:{width:`100%`}},{default:y(()=>[p(B,{value:`VND`},{default:y(()=>[...o[14]||=[g(`VND`,-1)]]),_:1}),p(B,{value:`USD`},{default:y(()=>[...o[15]||=[g(`USD`,-1)]]),_:1}),p(B,{value:`EUR`},{default:y(()=>[...o[16]||=[g(`EUR`,-1)]]),_:1})]),_:1},8,[`value`])]),_:1})]),_:1},8,[`model`])]),_:1},8,[`open`,`title`,`confirmLoading`])]))]),_:1})}}}),[[`__scopeId`,`data-v-c37f4a7c`]]);export{P as default};