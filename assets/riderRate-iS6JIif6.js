import"./EyeInvisibleOutlined-vBZdbnb5.js";import{n as e,t}from"./_plugin-vue_export-helper-CCMMWqEJ.js";import{a as n,o as r}from"./input-CE70cYGf.js";import{t as i}from"./table-Bj7AWOqL.js";import{r as a}from"./select-BktQDR1e.js";import{o as ee}from"./Col-B88sKFw0.js";import"./FolderOutlined-v8Whbuap.js";import{t as o}from"./modal-DoGUrgx-.js";import"./checkbox-o3cgUXip.js";import{t as s}from"./page-header-C9rWw0m-.js";import{t as c}from"./space-CGZIuoRS.js";import"./dropdown-kgT51ow1.js";import"./breadcrumb-DhykEvSa.js";import{n as l,t as u}from"./row-CYcdmHKM.js";import"./UpOutlined-ZUi5vTGj.js";import{t as d}from"./input-number-Jr8dvtpE.js";import"./spin-D756cOu2.js";import"./ArrowRightOutlined-BTInphOv.js";import{t as f}from"./popconfirm-Cd8ZXcgh.js";import{Dn as p,En as m,Rn as h,Sn as g,Tn as _,Vn as v,Xn as y,bn as b,dr as x,gn as S,l as C,nr as w,tr as T,wn as E,xn as D}from"./index-DYE8AE99.js";import{t as O}from"./pricingVersion-DI3n4qna.js";import{t as k}from"./productPlan-DbpaFBUo.js";import{t as A}from"./rider-I66MQYoI.js";var te={style:{display:`flex`,gap:`8px`,"align-items":`center`}},ne={key:1},j=t(p({__name:`index`,setup(t){let p=w(void 0),j=w(void 0),M=w(void 0),N=w([]),P=w([]),F=w([]),I=w(!1),L=b(()=>F.value.map(e=>({label:`${e.name} (${e.riderCode})`,value:e.riderCode}))),R=w([]),z=w(!1),B=w(1),V=w(20),H=w(0),U=T({current:B.value,pageSize:V.value,total:H.value,showSizeChanger:!0,pageSizeOptions:[`10`,`20`,`50`,`100`]});async function W(e=!0){if(!e)return;let t=p.value||Z.planId;if(t)try{let e=await O.getAll(t)??[],n=e.data??e??[];N.value=(Array.isArray(n)?n:n.items??n.Items??[]).map(e=>({label:e.pricingVersionId??e.name,value:e.pricingVersionId}))}catch(e){console.error(e)}}async function G(e=!0){if(e){I.value=!0;try{let e=await k.getAll({page:1,pageSize:500}),t=e.data??e??[];P.value=((Array.isArray(t)?t:t.items??t.Items??[])??[]).map(e=>({label:e.planId??e.planCode??e.name,value:e.planId??e.id}))}catch(e){console.error(e)}finally{I.value=!1}}}async function K(){try{let e=await A.queryMasters();F.value=e.data??e??[]}catch(e){console.error(e)}}async function q(e=B.value,t=V.value){z.value=!0;try{let n=await A.queryRates({pricingVersionId:j.value,riderCode:M.value,page:e,pageSize:t}),r=n.data??n??{},i=r.items??r.Items??r.Items??[],a=r.totalItems??r.TotalItems??r.total??0;R.value=Array.isArray(i)?i:[],H.value=Number(a)||0,B.value=r.page??e,V.value=r.pageSize??t,U.current=B.value,U.pageSize=V.value,U.total=H.value}catch(e){console.error(e),C.error(`Tải rate thất bại`)}finally{z.value=!1}}function J(e){let t=e.current??1,n=e.pageSize??V.value;B.value=t,V.value=n,q(t,n)}let Y=w(!1),X=w(!1),Z=T({planId:``,pricingVersionId:``,riderCode:``,ageMin:0,ageMax:0,ratePer1000:null,ratePerUnit:null,percentOfBase:null}),Q=w(null),re=[{title:`Pricing Version`,dataIndex:`pricingVersionId`,key:`pricingVersionId`},{title:`Rider`,dataIndex:`riderCode`,key:`riderCode`},{title:`Age Min`,dataIndex:`ageMin`,key:`ageMin`},{title:`Age Max`,dataIndex:`ageMax`,key:`ageMax`},{title:`Rate/1000`,dataIndex:`ratePer1000`,key:`ratePer1000`},{title:`Rate/Unit`,dataIndex:`ratePerUnit`,key:`ratePerUnit`},{title:`% Of Base`,dataIndex:`percentOfBase`,key:`percentOfBase`},{title:`Action`,key:`action`,fixed:`right`,width:160}],ie=b(()=>Q.value?`Sửa rate ${Q.value}`:`Tạo rate mới`);function $(e){e?(Z.pricingVersionId=e.pricingVersionId,Z.riderCode=e.riderCode,Z.ageMin=e.ageMin,Z.ageMax=e.ageMax,Z.ratePer1000=e.ratePer1000??null,Z.ratePerUnit=e.ratePerUnit??null,Z.percentOfBase=e.percentOfBase??null,Q.value=`${e.pricingVersionId}::${e.riderCode}::${e.ageMin}::${e.ageMax}`):(Z.pricingVersionId=j.value??``,Z.riderCode=M.value??``,Z.ageMin=0,Z.ageMax=0,Z.ratePer1000=null,Z.ratePerUnit=null,Z.percentOfBase=null,Q.value=null),Y.value=!0}async function ae(){X.value=!0;try{if(!Z.pricingVersionId||!Z.riderCode){C.warn(`Chọn pricing version và rider`);return}if(Z.ageMin>Z.ageMax){C.warn(`AgeMin phải <= AgeMax`);return}let e={pricingVersionId:Z.pricingVersionId,riderCode:Z.riderCode,ageMin:Z.ageMin,ageMax:Z.ageMax,ratePer1000:Z.ratePer1000,ratePerUnit:Z.ratePerUnit,percentOfBase:Z.percentOfBase};if(Q.value){let[t,n,r,i]=Q.value.split(`::`);await A.updateRate(t??``,n??``,Number(r),Number(i),e),C.success(`Cập nhật rate thành công`)}else await A.createRate(e),C.success(`Tạo rate thành công`);Y.value=!1,await q()}catch(e){console.error(e),C.error(e?.message??`Lưu thất bại`)}finally{X.value=!1}}async function oe(e){try{await A.deleteRate(e.pricingVersionId,e.riderCode,e.ageMin,e.ageMax),C.success(`Xóa thành công`),await q()}catch(e){console.error(e),C.error(e?.message??`Xóa thất bại`)}}return h(()=>{W(),K(),q(1,V.value)}),(t,h)=>{let b=s,C=a,w=e,T=ee,O=f,k=c,A=i,F=r,B=l,V=u,H=d,K=n,Q=o;return v(),E(S,null,[m(b,{title:`Cấu hình Tỷ lệ Rider`}),m(T,{class:`mb12`},{default:y(()=>[D(`div`,te,[m(C,{value:p.value,"onUpdate:value":h[0]||=e=>p.value=e,placeholder:`Plan`,style:{width:`240px`},"show-search":``,allowClear:``,options:P.value,loading:I.value,onDropdownVisibleChange:G},null,8,[`value`,`options`,`loading`]),m(C,{value:j.value,"onUpdate:value":h[1]||=e=>j.value=e,placeholder:`Pricing Version`,style:{width:`240px`},"show-search":``,onDropdownVisibleChange:W,options:N.value,onChange:h[2]||=()=>q()},null,8,[`value`,`options`]),m(C,{value:M.value,"onUpdate:value":h[3]||=e=>M.value=e,placeholder:`Rider`,style:{width:`240px`},options:L.value,allowClear:``,onChange:h[4]||=()=>q()},null,8,[`value`,`options`]),m(w,{type:`primary`,onClick:h[5]||=e=>$()},{default:y(()=>[...h[17]||=[_(`Tạo Rate`,-1)]]),_:1}),m(w,{onClick:h[6]||=()=>q()},{default:y(()=>[...h[18]||=[_(`Làm mới`,-1)]]),_:1})])]),_:1}),m(T,{title:`Danh sách Rate`},{default:y(()=>[m(A,{columns:re,dataSource:R.value,rowKey:e=>`${e.pricingVersionId}::${e.riderCode}::${e.ageMin}::${e.ageMax}`,pagination:U,loading:z.value,onChange:J,scroll:{x:1200,y:500}},{bodyCell:y(({column:e,record:t})=>[e.key===`action`?(v(),g(k,{key:0,style:{"justify-content":`flex-end`,width:`100%`}},{default:y(()=>[m(w,{size:`small`,onClick:e=>$(t)},{default:y(()=>[...h[19]||=[_(`Sửa`,-1)]]),_:1},8,[`onClick`]),m(O,{title:`Xóa rate này?`,onConfirm:()=>oe(t)},{default:y(()=>[m(w,{size:`small`,danger:``},{default:y(()=>[...h[20]||=[_(`Xóa`,-1)]]),_:1})]),_:1},8,[`onConfirm`])]),_:2},1024)):(v(),E(`span`,ne,x(t[e.dataIndex]),1))]),_:1},8,[`dataSource`,`rowKey`,`pagination`,`loading`])]),_:1}),m(Q,{visible:Y.value,"onUpdate:visible":h[15]||=e=>Y.value=e,title:ie.value,onOk:ae,onCancel:h[16]||=e=>Y.value=!1,confirmLoading:X.value},{default:y(()=>[m(K,{layout:`vertical`},{default:y(()=>[m(V,{gutter:8},{default:y(()=>[m(B,{span:12},{default:y(()=>[m(F,{label:`Plan Id`},{default:y(()=>[m(C,{value:Z.planId,"onUpdate:value":h[7]||=e=>Z.planId=e,options:P.value,onDropdownVisibleChange:G},null,8,[`value`,`options`])]),_:1})]),_:1}),m(B,{span:12},{default:y(()=>[m(F,{label:`Pricing Version`},{default:y(()=>[m(C,{value:Z.pricingVersionId,"onUpdate:value":h[8]||=e=>Z.pricingVersionId=e,options:N.value,onDropdownVisibleChange:W},null,8,[`value`,`options`])]),_:1})]),_:1}),m(B,{span:12},{default:y(()=>[m(F,{label:`Rider Code`},{default:y(()=>[m(C,{value:Z.riderCode,"onUpdate:value":h[9]||=e=>Z.riderCode=e,options:L.value},null,8,[`value`,`options`])]),_:1})]),_:1})]),_:1}),m(V,{gutter:8},{default:y(()=>[m(B,{span:8},{default:y(()=>[m(F,{label:`Age Min`},{default:y(()=>[m(H,{value:Z.ageMin,"onUpdate:value":h[10]||=e=>Z.ageMin=e,style:{width:`100%`}},null,8,[`value`])]),_:1})]),_:1}),m(B,{span:8},{default:y(()=>[m(F,{label:`Age Max`},{default:y(()=>[m(H,{value:Z.ageMax,"onUpdate:value":h[11]||=e=>Z.ageMax=e,style:{width:`100%`}},null,8,[`value`])]),_:1})]),_:1}),m(B,{span:8},{default:y(()=>[m(F,{label:`Rate /1000`},{default:y(()=>[m(H,{value:Z.ratePer1000,"onUpdate:value":h[12]||=e=>Z.ratePer1000=e,style:{width:`100%`},step:1e-4},null,8,[`value`])]),_:1})]),_:1})]),_:1}),m(V,{gutter:8},{default:y(()=>[m(B,{span:8},{default:y(()=>[m(F,{label:`Rate /Unit`},{default:y(()=>[m(H,{value:Z.ratePerUnit,"onUpdate:value":h[13]||=e=>Z.ratePerUnit=e,style:{width:`100%`},step:1e-4},null,8,[`value`])]),_:1})]),_:1}),m(B,{span:8},{default:y(()=>[m(F,{label:`% Of Base`},{default:y(()=>[m(H,{value:Z.percentOfBase,"onUpdate:value":h[14]||=e=>Z.percentOfBase=e,style:{width:`100%`},step:.01},null,8,[`value`])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,[`visible`,`title`,`confirmLoading`])],64)}}}),[[`__scopeId`,`data-v-8f6448fa`]]);export{j as default};