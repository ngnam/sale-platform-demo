import{a as e,u as t}from"./EyeInvisibleOutlined-vBZdbnb5.js";import{n,t as r}from"./_plugin-vue_export-helper-CCMMWqEJ.js";import{a as ee,i as te,l as i,o as ne}from"./input-CE70cYGf.js";import{i as a,t as re}from"./table-Bj7AWOqL.js";import{r as ie,t as ae}from"./select-BktQDR1e.js";import{o as oe}from"./Col-B88sKFw0.js";import"./FolderOutlined-v8Whbuap.js";import{t as o}from"./modal-DoGUrgx-.js";import"./checkbox-o3cgUXip.js";import"./dropdown-kgT51ow1.js";import"./SwapRightOutlined-B30FF2QO.js";import"./es-1eb-LgCN.js";import"./UpOutlined-ZUi5vTGj.js";import"./spin-D756cOu2.js";import"./ArrowRightOutlined-BTInphOv.js";import{Dn as s,En as c,Nn as l,Rn as u,Sn as d,Tn as f,Un as p,Vn as m,Wn as se,Xn as h,a as g,bn as _,cn as v,cr as y,dr as b,gn as x,i as S,kn as C,l as w,mn as ce,n as T,nr as E,r as D,sn as O,ur as le,wn as k,xn as A}from"./index-DYE8AE99.js";import{t as ue}from"./Icon-wKyRgJuN.js";import{t as de}from"./dateUtil-JHk6KmED.js";import{t as j}from"./pricingVersion-DI3n4qna.js";const M=[{title:`No`,dataIndex:`index`,key:`index`,width:80},{title:`Pricing Version Id`,dataIndex:`pricingVersionId`,key:`pricingVersionId`,width:240,sorter:!0,sortDirections:[`ascend`,`descend`]},{title:`Rounding Premium`,dataIndex:`roundingPremium`,key:`roundingPremium`,width:180,customRender:({text:e})=>C(`span`,e??`-`)},{title:`Rounding Cash Val`,dataIndex:`roundingCashVal`,key:`roundingCashVal`,width:180,customRender:({text:e})=>C(`span`,e??`-`)},{title:`Action`,key:`action`,fixed:`right`,width:160}];var N={base:e=>`/product-plans/${encodeURIComponent(e)}/versions`};const P={getAll:async e=>D(N.base(e)),getDetail:async(e,t)=>D(`${N.base(e)}/${encodeURIComponent(t)}`),create:async(e,t)=>S(N.base(e),t),update:async(e,t,n)=>g(`${N.base(e)}/${encodeURIComponent(t)}`,n),remove:async(e,t)=>T(`${N.base(e)}/${encodeURIComponent(t)}`)};var fe={class:`plan-version-page`},pe={class:`title`},me={style:{display:`flex`,gap:`12px`,"align-items":`center`,"margin-bottom":`8px`}},he={key:0},ge=[`onClick`,`type`],_e={key:1},F=r(s({__name:`index`,props:{planId:{},pricingVersionId:{}},setup(r){let s=v(),g=r.planId??O().params.planId,S=E([]),C=E(!1);async function T(){C.value=!0;try{let e=await j.getAll(g);S.value=e.data??e??[]}catch(e){console.error(e)}finally{C.value=!1}}let D=async e=>{e&&await T()};u(async()=>{await Y(),await T()});let N=E([{value:`NONE`,label:`None (no rounding)`},{value:`NEAREST_1`,label:`Nearest 1`},{value:`NEAREST_10`,label:`Nearest 10`},{value:`NEAREST_100`,label:`Nearest 100`},{value:`NEAREST_1000`,label:`Nearest 1,000`},{value:`CEILING_10`,label:`Ceiling 10 (round up)`},{value:`CEILING_100`,label:`Ceiling 100 (round up)`},{value:`FLOOR_10`,label:`Floor 10 (round down)`},{value:`FLOOR_100`,label:`Floor 100 (round down)`}]),F=E(``),I=E(!1),L=E(!1),R=E(!1),z=E(!1),B=E(null),V=E(1),H=E(20),U=E(0),W=E([]),G=E([]),K={pricingVersionId:``,roundingPremium:void 0,roundingCashVal:void 0},q=E({...K}),J=E(),ve=M,ye=_(()=>({current:V.value,pageSize:H.value,total:U.value,showSizeChanger:!0,showQuickJumper:!0})),be=e=>e.pricingVersionId,xe=_(()=>W.value.map((e,t)=>({...e,index:(V.value-1)*H.value+t+1,__onEdit:Z,__onDelete:Q}))),Se=_(()=>({selectedRowKeys:G.value,onChange:(e,t)=>{G.value=e.slice()}})),Ce={pricingVersionId:[{required:!0,message:`PricingVersionId required`,trigger:`blur`}]},Y=async()=>{I.value=!0;try{let e=await P.getAll(g),t=e.data??e;W.value=Array.from(t??[]),U.value=W.value.length}catch(e){console.error(e),w.error(`Load plan versions failed`)}finally{I.value=!1}},X=async()=>{V.value=1,await Y()},we=async e=>{e&&(V.value=e.current||V.value,H.value=e.pageSize||H.value),await Y()},Te=async()=>{console.log(q.value),z.value=!1,B.value=null,Object.assign(q.value,i(K)),R.value=!0,await l(),J.value?.resetFields?.(i(K)),J.value?.clearValidate?.(),await l()};async function Z(e){z.value=!0,B.value=e.pricingVersionId;try{let t=await P.getDetail(g,e.pricingVersionId),n=t.data??t;Object.assign(q.value,{pricingVersionId:n.pricingVersionId,roundingPremium:n.roundingPremium??null,roundingCashVal:n.roundingCashVal??null}),await l(),R.value=!0,J.value?.clearValidate()}catch(e){console.error(e),w.error(`Load version detail failed`)}}async function Q(e){o.confirm({title:`Delete plan version`,content:`Delete version ${e.pricingVersionId}?`,onOk:async()=>{try{await P.remove(g,e.pricingVersionId),w.success(`Deleted`),G.value=G.value.filter(t=>t!==e.pricingVersionId),Y()}catch(e){console.error(e),w.error(`Delete failed`)}}})}let Ee=async()=>{G.value.length&&o.confirm({title:`Delete ${G.value.length} version(s)`,content:`Are you sure to delete selected versions?`,onOk:async()=>{try{for(let e of[...G.value])await P.remove(g,e);w.success(`Deleted selected versions`),G.value=[],V.value=1,Y()}catch(e){console.error(e),w.error(`Delete failed`)}}})},De=async()=>{try{await J.value?.validate?.()}catch{return}let e={pricingVersionId:(q.value.pricingVersionId??``).trim(),roundingPremium:q.value.roundingPremium??null,roundingCashVal:q.value.roundingCashVal??null},t={roundingPremium:q.value.roundingPremium??null,roundingCashVal:q.value.roundingCashVal??null};L.value=!0;try{z.value&&B.value?(await P.update(g,B.value,t),w.success(`Updated`)):(await P.create(g,e),w.success(`Created`)),R.value=!1,G.value=[],Y()}catch(e){console.error(e);let t=e?.response?.data?.message??e?.response?.data??`Save failed`;w.error(String(t))}finally{L.value=!1}},Oe=()=>{R.value=!1};function ke(e){return e.key===`edit`?`EditOutlined`:e.key===`delete`?`DeleteOutlined`:e.key===`planVersion`?`ProfileOutlined`:e.key===`pricingVersion`?`DatabaseOutlined`:`AppstoreOutlined`}function Ae(e,t){return typeof e.label==`function`?e.label(t):e.label}function je(e){return[{key:`edit`,label:`Edit`,type:`default`,permission:!0,enable:!0,onClick:Z},{key:`delete`,label:`Delete`,type:`danger`,permission:!0,enable:!0,onClick:Q}]}function Me(e,t){try{e.domEvent?.stopPropagation?.();let n=e.key;if(n===`edit`)return $(t,`__onEdit`);if(n===`delete`)return $(t,`__onDelete`)}catch(e){console.error(`onMenuClickWithRecord error`,e),w.error(`Action failed`)}}function $(e,t){try{let n=e?.[t];if(typeof n==`function`)return n(e);console.warn(`${t} is not a function on record`,e)}catch(e){console.error(`safeCall error`,e)}}return(r,i)=>{let l=te,u=n,_=ue,v=t,w=e,T=a,E=re,O=oe,j=ae,M=ie,P=ne,B=ee,V=o,H=se(`router-view`);return m(),d(H,null,{default:h(({route:e})=>[A(`div`,fe,[A(`h2`,pe,`Plan Versions for `+b(y(g)),1),c(O,{class:`mb16`,"body-style":{padding:`12px`}},{default:h(()=>[A(`div`,me,[c(l,{value:F.value,"onUpdate:value":i[0]||=e=>F.value=e,placeholder:`Search by PricingVersionId`,onSearch:X,style:{width:`360px`},allowClear:``},null,8,[`value`]),c(u,{type:`primary`,onClick:Te},{default:h(()=>[...i[8]||=[f(`Create Version`,-1)]]),_:1}),c(u,{danger:``,disabled:!G.value.length,onClick:Ee},{default:h(()=>[...i[9]||=[f(`Delete Selected`,-1)]]),_:1},8,[`disabled`]),c(u,{loading:I.value,onClick:Y},{default:h(()=>[...i[10]||=[f(`Refresh`,-1)]]),_:1},8,[`loading`]),c(u,{type:`default`,onClick:i[1]||=()=>y(s).push({name:`PricingVersions`,params:{planId:y(g)}})},{default:h(()=>[...i[11]||=[f(` Pricing Versions `,-1)]]),_:1})]),c(E,{columns:y(ve),dataSource:xe.value,loading:I.value,pagination:ye.value,rowKey:be,rowSelection:Se.value,scroll:{x:1e3},onChange:we},{bodyCell:h(({column:e,record:t})=>[e.key===`action`?(m(),d(T,{key:0,placement:`topLeft`,trigger:`click`},{overlay:h(()=>[c(w,{class:`menu-box`,onClick:i[2]||=()=>Me},{default:h(()=>[(m(!0),k(x,null,p(je(t),(e,n)=>(m(),d(v,{key:`${n}-${e.label}`,style:le({color:e.type===`delete`?`red`:`inherit`})},{icon:h(()=>[c(_,{align:`2px`,size:`15px`,style:{"margin-right":`12px`},type:ke(e)},null,8,[`type`])]),default:h(()=>[e.permission===!1?(m(),k(`span`,he,`——`)):(m(),k(`a`,{key:1,onClick:()=>e.onClick?.(t),type:e.type},b(Ae(e,t)),9,ge))]),_:2},1032,[`style`]))),128))]),_:2},1024)]),default:h(()=>[A(`span`,{class:`ant-dropdown-link`,role:`button`,tabindex:`0`,onClick:i[3]||=ce(()=>{},[`prevent`])},[c(_,{align:`2px`,size:`20px`,style:{"margin-left":`5px`},type:`EllipsisOutlined`})])]),_:2},1024)):(m(),k(`span`,_e,b(t[e.dataIndex]),1))]),_:1},8,[`columns`,`dataSource`,`loading`,`pagination`,`rowSelection`])]),_:1}),c(V,{open:R.value,"onUpdate:open":i[7]||=e=>R.value=e,title:z.value?`Edit Plan Version`:`Create Plan Version`,onOk:De,onCancel:Oe,confirmLoading:L.value,width:640,centered:``},{default:h(()=>[c(B,{ref_key:`formRef`,ref:J,model:q.value,rules:Ce,layout:`vertical`},{default:h(()=>[c(P,{label:`Pricing Version Id`,name:`pricingVersionId`,rules:z.value?[]:[{required:!0,message:`PricingVersionId required`}]},{default:h(()=>[c(M,{value:q.value.pricingVersionId,"onUpdate:value":i[4]||=e=>q.value.pricingVersionId=e,placeholder:`Select pricing version`,disabled:z.value,loading:C.value,showSearch:``,optionFilterProp:`label`,allowClear:``,onDropdownVisibleChange:D},{default:h(()=>[(m(!0),k(x,null,p(S.value,e=>(m(),d(j,{key:e.pricingVersionId,value:e.pricingVersionId},{default:h(()=>[f(b(e.pricingVersionId)+` - `+b(y(de)(e.effectiveFrom)),1)]),_:2},1032,[`value`]))),128))]),_:1},8,[`value`,`disabled`,`loading`])]),_:1},8,[`rules`]),c(P,{label:`Rounding Premium`,name:`roundingPremium`},{default:h(()=>[c(M,{value:q.value.roundingPremium,"onUpdate:value":i[5]||=e=>q.value.roundingPremium=e,placeholder:`Select rounding rule for premium`,allowClear:``},{default:h(()=>[(m(!0),k(x,null,p(N.value,e=>(m(),d(j,{key:e.value,value:e.value},{default:h(()=>[f(b(e.label),1)]),_:2},1032,[`value`]))),128))]),_:1},8,[`value`])]),_:1}),c(P,{label:`Rounding Cash Val`,name:`roundingCashVal`},{default:h(()=>[c(M,{value:q.value.roundingCashVal,"onUpdate:value":i[6]||=e=>q.value.roundingCashVal=e,placeholder:`Select rounding rule for cash value`,allowClear:``},{default:h(()=>[(m(!0),k(x,null,p(N.value,e=>(m(),d(j,{key:e.value,value:e.value},{default:h(()=>[f(b(e.label),1)]),_:2},1032,[`value`]))),128))]),_:1},8,[`value`])]),_:1})]),_:1},8,[`model`])]),_:1},8,[`open`,`title`,`confirmLoading`])])]),_:1})}}}),[[`__scopeId`,`data-v-5134830b`]]);export{F as default};