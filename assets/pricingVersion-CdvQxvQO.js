import{o as e,t}from"./menu-KmJeyBmp.js";import{n,t as r}from"./_plugin-vue_export-helper-DjLyun5i.js";import{a as i,i as ee,l as a,o,t as s}from"./input-Dl58X2zG.js";import{i as te,t as ne}from"./table-B5NlV_bM.js";import{r as re,t as ie}from"./select-qwNyy2X6.js";import{o as ae}from"./Col-Dn_WxAuq.js";import"./FolderOutlined-CuOYp4hi.js";import"./EyeInvisibleOutlined-DQ7XOaOB.js";import{t as c}from"./modal-7zbmb4iA.js";import"./move-BV2dG8Yt.js";import"./checkbox-DTOnil2W.js";import"./dropdown-BjYLSNDe.js";import"./dayjs-Di-yguGE.js";import"./SwapRightOutlined-DC-xg5cP.js";import{t as l}from"./date-picker-ekm1N11q.js";import"./es-DfE0qcvE.js";import"./UpOutlined-CVKY-LmD.js";import"./spin-CjGf5sPd.js";import"./ArrowRightOutlined-jL2ruyWB.js";import{Bn as u,Cn as d,Dn as f,En as p,Fn as m,Gn as oe,Kn as se,Qn as h,Sn as g,Tn as _,Un as v,_n as ce,fr as y,hn as b,ir as x,jn as S,kn as C,pr as w,u as T,ur as E,xn as D}from"./index-DNW3ueIJ.js";import{t as le}from"./Icon-LsJhdwkb.js";import{a as O,i as k,r as A,t as j}from"./dateUtil-Dnzq1uhr.js";import{t as M}from"./pricingVersion-CIfy60JL.js";const N=[{title:`No`,dataIndex:`index`,key:`index`,width:80},{title:`Pricing Version Id`,dataIndex:`pricingVersionId`,key:`pricingVersionId`,width:240,sorter:!0,sortDirections:[`ascend`,`descend`]},{title:`Effective From`,dataIndex:`effectiveFrom`,key:`effectiveFrom`,width:180,customRender:({text:e})=>S(`span`,e?j(k(e)):`-`)},{title:`Effective To`,dataIndex:`effectiveTo`,key:`effectiveTo`,width:180,customRender:({text:e})=>S(`span`,e?j(k(e)):`-`)},{title:`Status`,dataIndex:`status`,key:`status`,width:120},{title:`Action`,key:`action`,fixed:`right`,width:80}];var ue={class:`pricing-version-page`},de={class:`title`},P={style:{display:`flex`,gap:`12px`,"align-items":`center`,"margin-bottom":`8px`}},F={key:0},I=[`onClick`,`type`],L={key:1},R=r(C({__name:`index`,props:{planId:{}},setup(r){let S=r.planId??``,C=x(``),k=x(!1),j=x(!1),R=x(!1),z=x(!1),B=x(null),V=x(1),H=x(20),U=x(0),W=x([]),G=x([]),K={pricingVersionId:``,effectiveFrom:void 0,effectiveTo:void 0,status:`DRAFT`},q=x({...K}),J=x(),fe=N,pe=D(()=>({current:V.value,pageSize:H.value,total:U.value,showSizeChanger:!0,showQuickJumper:!0})),me=e=>e.pricingVersionId,he=D(()=>W.value.map((e,t)=>({...e,index:(V.value-1)*H.value+t+1,__onEdit:X,__onDelete:Z,__onView:Q}))),ge=D(()=>({selectedRowKeys:G.value,onChange:e=>{G.value=e.slice()}})),_e={pricingVersionId:[{required:!0,message:`PricingVersionId required`,trigger:`blur`}],effectiveFrom:[{type:`object`,required:!0,message:`EffectiveFrom required`,trigger:`change`}],effectiveTo:[{type:`object`,required:!1,message:`EffectiveTo required`,trigger:`change`}]},Y=async()=>{k.value=!0;try{let e=await M.getAll(S);W.value=e.data??e??[],U.value=W.value.length}catch(e){console.error(e),T.error(`Load pricing versions failed`)}finally{k.value=!1}},ve=()=>{V.value=1,Y()},ye=e=>{e&&(V.value=e.current||V.value,H.value=e.pageSize||H.value),Y()},be=async()=>{z.value=!1,B.value=null,Object.assign(q.value,a(K)),R.value=!0,await m(),J.value?.resetFields?.(a(K)),J.value?.clearValidate?.(),await m()};async function X(e){z.value=!0,B.value=e.pricingVersionId;try{let t=await M.getDetail(S,e.pricingVersionId),n=t.data??t;Object.assign(q.value,{pricingVersionId:n.pricingVersionId,effectiveFrom:n.effectiveFrom?A(n.effectiveFrom):void 0,effectiveTo:n.effectiveTo?A(n.effectiveTo):void 0,status:n.status??`DRAFT`}),R.value=!0,await m(),J.value?.clearValidate()}catch(e){console.error(e),T.error(`Load pricing version detail failed`)}}async function Z(e){c.confirm({title:`Delete pricing version`,content:`Delete version ${e.pricingVersionId}?`,onOk:async()=>{try{await M.remove(S,e.pricingVersionId),T.success(`Deleted`),G.value=G.value.filter(t=>t!==e.pricingVersionId),Y()}catch(e){console.error(e),T.error(`Delete failed`)}}})}function Q(e){T.info(`View ${e.pricingVersionId}`)}let xe=async()=>{G.value.length&&c.confirm({title:`Delete ${G.value.length} version(s)`,content:`Are you sure to delete selected versions?`,onOk:async()=>{try{for(let e of[...G.value])await M.remove(S,e);T.success(`Deleted selected versions`),G.value=[],V.value=1,Y()}catch(e){console.error(e),T.error(`Delete failed`)}}})},Se=async()=>{try{await J.value?.validate?.()}catch{return}let e={pricingVersionId:(q.value.pricingVersionId??``).trim(),effectiveFrom:O(q.value.effectiveFrom),effectiveTo:q.value.effectiveTo?O(q.value.effectiveTo):null,createdBy:void 0},t={effectiveFrom:O(q.value.effectiveFrom),effectiveTo:q.value.effectiveTo?O(q.value.effectiveTo):null,status:q.value.status??`DRAFT`};j.value=!0;try{z.value&&B.value?(await M.update(S,B.value,t),T.success(`Updated`)):(await M.create(S,e),T.success(`Created`)),R.value=!1,G.value=[],Y()}catch(e){console.error(e),T.error(String(e?.response?.data?.message??`Save failed`))}finally{j.value=!1}},Ce=()=>{R.value=!1};u(async()=>{await Y()});function we(e){return e.key===`edit`?`EditOutlined`:e.key===`delete`?`DeleteOutlined`:e.key===`planVersion`?`ProfileOutlined`:e.key===`pricingVersion`?`DatabaseOutlined`:`AppstoreOutlined`}function Te(e,t){return typeof e.label==`function`?e.label(t):e.label}function Ee(e){return[{key:`edit`,label:`Edit`,type:`default`,permission:!0,enable:!0,onClick:X},{key:`delete`,label:`Delete`,type:`danger`,permission:!0,enable:!0,onClick:Z},{key:`view`,label:`View`,type:`default`,permission:!0,enable:!0,onClick:Q}]}function De(e,t){try{e.domEvent?.stopPropagation?.();let n=e.key;if(n===`edit`)return $(t,`__onEdit`);if(n===`delete`)return $(t,`__onDelete`);if(n===`view`)return $(t,`__onView`)}catch(e){console.error(`onMenuClickWithRecord error`,e),T.error(`Action failed`)}}function $(e,t){try{let n=e?.[t];if(typeof n==`function`)return n(e);console.warn(`${t} is not a function on record`,e)}catch(e){console.error(`safeCall error`,e)}}return(r,a)=>{let u=ee,m=n,x=le,T=e,D=t,O=te,A=ne,M=ae,N=s,B=o,V=l,H=ie,U=re,W=i,K=c,X=se(`router-view`);return v(),d(X,null,{default:h(({route:e})=>[g(`div`,ue,[g(`h2`,de,`Pricing Versions for `+w(E(S)),1),f(M,{class:`mb16`,"body-style":{padding:`12px`}},{default:h(()=>[g(`div`,P,[f(u,{value:C.value,"onUpdate:value":a[0]||=e=>C.value=e,placeholder:`Search by PricingVersionId`,onSearch:ve,style:{width:`360px`},allowClear:``},null,8,[`value`]),f(m,{type:`primary`,onClick:be},{default:h(()=>[...a[8]||=[p(`Create Pricing Version`,-1)]]),_:1}),f(m,{danger:``,disabled:!G.value.length,onClick:xe},{default:h(()=>[...a[9]||=[p(`Delete Selected`,-1)]]),_:1},8,[`disabled`]),f(m,{loading:k.value,onClick:Y},{default:h(()=>[...a[10]||=[p(`Refresh`,-1)]]),_:1},8,[`loading`])]),f(A,{columns:E(fe),dataSource:he.value,loading:k.value,pagination:pe.value,rowKey:me,rowSelection:ge.value,scroll:{x:1e3},onChange:ye},{bodyCell:h(({column:e,record:t})=>[e.key===`action`?(v(),d(O,{key:0,placement:`topLeft`,trigger:`click`},{overlay:h(()=>[f(D,{class:`menu-box`,onClick:a[1]||=()=>De},{default:h(()=>[(v(!0),_(ce,null,oe(Ee(t),(e,n)=>(v(),d(T,{key:`${n}-${e.label}`,style:y({color:e.type===`delete`?`red`:`inherit`})},{icon:h(()=>[f(x,{align:`2px`,size:`15px`,style:{"margin-right":`12px`},type:we(e)},null,8,[`type`])]),default:h(()=>[e.permission===!1?(v(),_(`span`,F,`——`)):(v(),_(`a`,{key:1,onClick:()=>e.onClick?.(t),type:e.type},w(Te(e,t)),9,I))]),_:2},1032,[`style`]))),128))]),_:2},1024)]),default:h(()=>[g(`span`,{class:`ant-dropdown-link`,role:`button`,tabindex:`0`,onClick:a[2]||=b(()=>{},[`prevent`])},[f(x,{align:`2px`,size:`20px`,style:{"margin-left":`5px`},type:`EllipsisOutlined`})])]),_:2},1024)):(v(),_(`span`,L,w(t[e.dataIndex]),1))]),_:1},8,[`columns`,`dataSource`,`loading`,`pagination`,`rowSelection`])]),_:1}),f(K,{open:R.value,"onUpdate:open":a[7]||=e=>R.value=e,title:z.value?`Edit Pricing Version`:`Create Pricing Version`,onOk:Se,onCancel:Ce,confirmLoading:j.value,width:640,centered:``},{default:h(()=>[f(W,{ref_key:`formRef`,ref:J,model:q.value,rules:_e,layout:`vertical`},{default:h(()=>[f(B,{label:`Pricing Version Id`,name:`pricingVersionId`,rules:z.value?[]:[{required:!0,message:`PricingVersionId required`}]},{default:h(()=>[f(N,{value:q.value.pricingVersionId,"onUpdate:value":a[3]||=e=>q.value.pricingVersionId=e,disabled:z.value,placeholder:`e.g. PRC_2025_09`},null,8,[`value`,`disabled`])]),_:1},8,[`rules`]),f(B,{label:`Effective From`,name:`effectiveFrom`,rules:[{required:!0,message:`EffectiveFrom required`}]},{default:h(()=>[f(V,{value:q.value.effectiveFrom,"onUpdate:value":a[4]||=e=>q.value.effectiveFrom=e,style:{width:`100%`}},null,8,[`value`])]),_:1}),f(B,{label:`Effective To`,name:`effectiveTo`},{default:h(()=>[f(V,{value:q.value.effectiveTo,"onUpdate:value":a[5]||=e=>q.value.effectiveTo=e,style:{width:`100%`}},null,8,[`value`])]),_:1}),f(B,{label:`Status`,name:`status`},{default:h(()=>[f(U,{value:q.value.status,"onUpdate:value":a[6]||=e=>q.value.status=e,placeholder:`Select status`},{default:h(()=>[f(H,{value:`DRAFT`},{default:h(()=>[...a[11]||=[p(`DRAFT`,-1)]]),_:1}),f(H,{value:`REVIEW`},{default:h(()=>[...a[12]||=[p(`REVIEW`,-1)]]),_:1}),f(H,{value:`APPROVED`},{default:h(()=>[...a[13]||=[p(`APPROVED`,-1)]]),_:1})]),_:1},8,[`value`])]),_:1})]),_:1},8,[`model`])]),_:1},8,[`open`,`title`,`confirmLoading`])])]),_:1})}}}),[[`__scopeId`,`data-v-0e571099`]]);export{R as default};