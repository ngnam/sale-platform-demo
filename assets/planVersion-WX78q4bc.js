import{o as e,t}from"./menu-Bhhdg46M.js";import{n,t as r}from"./_plugin-vue_export-helper-DPrR5wxB.js";import{a as ee,i as te,l as i,o as a}from"./input-eiSd8m4U.js";import{i as ne,t as re}from"./table-CUhhiDtX.js";import{r as ie,t as ae}from"./select-CUdbhWXi.js";import{o as oe}from"./Col-BC3b6lLj.js";import"./FolderOutlined-BkULr9jo.js";import"./EyeInvisibleOutlined-CiHbfsZv.js";import{t as o}from"./modal-BY8tMKRC.js";import"./move-CCKEGgz9.js";import"./checkbox-CSeGYwQi.js";import"./dropdown-DVBnKecP.js";import"./SwapRightOutlined-Bi0nCzpl.js";import"./es-cWQM0SPO.js";import"./UpOutlined-BExqSuUa.js";import"./spin-BdioGjXa.js";import"./ArrowRightOutlined-BcK4grMB.js";import{Bn as s,Cn as c,Dn as l,En as u,Fn as d,Gn as f,Kn as se,Qn as p,Sn as m,Tn as h,Un as g,_n as _,a as v,cn as y,fr as ce,hn as le,i as b,ir as x,jn as S,kn as C,ln as w,o as T,pr as E,r as D,u as O,ur as k,xn as A}from"./index-_V7Bdtlq.js";import{t as ue}from"./Icon-Br7fy9kg.js";import{t as de}from"./dateUtil-CChGlgN1.js";import{t as j}from"./pricingVersion-BT5qkrK_.js";const M=[{title:`No`,dataIndex:`index`,key:`index`,width:80},{title:`Pricing Version Id`,dataIndex:`pricingVersionId`,key:`pricingVersionId`,width:240,sorter:!0,sortDirections:[`ascend`,`descend`]},{title:`Rounding Premium`,dataIndex:`roundingPremium`,key:`roundingPremium`,width:180,customRender:({text:e})=>S(`span`,e??`-`)},{title:`Rounding Cash Val`,dataIndex:`roundingCashVal`,key:`roundingCashVal`,width:180,customRender:({text:e})=>S(`span`,e??`-`)},{title:`Action`,key:`action`,fixed:`right`,width:160}];var N={base:e=>`/product-plans/${encodeURIComponent(e)}/versions`};const P={getAll:async e=>b(N.base(e)),getDetail:async(e,t)=>b(`${N.base(e)}/${encodeURIComponent(t)}`),create:async(e,t)=>v(N.base(e),t),update:async(e,t,n)=>T(`${N.base(e)}/${encodeURIComponent(t)}`,n),remove:async(e,t)=>D(`${N.base(e)}/${encodeURIComponent(t)}`)};var fe={class:`plan-version-page`},pe={class:`title`},me={style:{display:`flex`,gap:`12px`,"align-items":`center`,"margin-bottom":`8px`}},he={key:0},ge=[`onClick`,`type`],_e={key:1},F=r(C({__name:`index`,props:{planId:{},pricingVersionId:{}},setup(r){let v=w(),b=r.planId??y().params.planId,S=x([]),C=x(!1);async function T(){C.value=!0;try{let e=await j.getAll(b);S.value=e.data??e??[]}catch(e){console.error(e)}finally{C.value=!1}}let D=async e=>{e&&await T()};s(async()=>{await Y(),await T()});let N=x([{value:`NONE`,label:`None (no rounding)`},{value:`NEAREST_1`,label:`Nearest 1`},{value:`NEAREST_10`,label:`Nearest 10`},{value:`NEAREST_100`,label:`Nearest 100`},{value:`NEAREST_1000`,label:`Nearest 1,000`},{value:`CEILING_10`,label:`Ceiling 10 (round up)`},{value:`CEILING_100`,label:`Ceiling 100 (round up)`},{value:`FLOOR_10`,label:`Floor 10 (round down)`},{value:`FLOOR_100`,label:`Floor 100 (round down)`}]),F=x(``),I=x(!1),L=x(!1),R=x(!1),z=x(!1),B=x(null),V=x(1),H=x(20),U=x(0),W=x([]),G=x([]),K={pricingVersionId:``,roundingPremium:void 0,roundingCashVal:void 0},q=x({...K}),J=x(),ve=M,ye=A(()=>({current:V.value,pageSize:H.value,total:U.value,showSizeChanger:!0,showQuickJumper:!0})),be=e=>e.pricingVersionId,xe=A(()=>W.value.map((e,t)=>({...e,index:(V.value-1)*H.value+t+1,__onEdit:Z,__onDelete:Q}))),Se=A(()=>({selectedRowKeys:G.value,onChange:(e,t)=>{G.value=e.slice()}})),Ce={pricingVersionId:[{required:!0,message:`PricingVersionId required`,trigger:`blur`}]},Y=async()=>{I.value=!0;try{let e=await P.getAll(b),t=e.data??e;W.value=Array.from(t??[]),U.value=W.value.length}catch(e){console.error(e),O.error(`Load plan versions failed`)}finally{I.value=!1}},X=async()=>{V.value=1,await Y()},we=async e=>{e&&(V.value=e.current||V.value,H.value=e.pageSize||H.value),await Y()},Te=async()=>{console.log(q.value),z.value=!1,B.value=null,Object.assign(q.value,i(K)),R.value=!0,await d(),J.value?.resetFields?.(i(K)),J.value?.clearValidate?.(),await d()};async function Z(e){z.value=!0,B.value=e.pricingVersionId;try{let t=await P.getDetail(b,e.pricingVersionId),n=t.data??t;Object.assign(q.value,{pricingVersionId:n.pricingVersionId,roundingPremium:n.roundingPremium??null,roundingCashVal:n.roundingCashVal??null}),await d(),R.value=!0,J.value?.clearValidate()}catch(e){console.error(e),O.error(`Load version detail failed`)}}async function Q(e){o.confirm({title:`Delete plan version`,content:`Delete version ${e.pricingVersionId}?`,onOk:async()=>{try{await P.remove(b,e.pricingVersionId),O.success(`Deleted`),G.value=G.value.filter(t=>t!==e.pricingVersionId),Y()}catch(e){console.error(e),O.error(`Delete failed`)}}})}let Ee=async()=>{G.value.length&&o.confirm({title:`Delete ${G.value.length} version(s)`,content:`Are you sure to delete selected versions?`,onOk:async()=>{try{for(let e of[...G.value])await P.remove(b,e);O.success(`Deleted selected versions`),G.value=[],V.value=1,Y()}catch(e){console.error(e),O.error(`Delete failed`)}}})},De=async()=>{try{await J.value?.validate?.()}catch{return}let e={pricingVersionId:(q.value.pricingVersionId??``).trim(),roundingPremium:q.value.roundingPremium??null,roundingCashVal:q.value.roundingCashVal??null},t={roundingPremium:q.value.roundingPremium??null,roundingCashVal:q.value.roundingCashVal??null};L.value=!0;try{z.value&&B.value?(await P.update(b,B.value,t),O.success(`Updated`)):(await P.create(b,e),O.success(`Created`)),R.value=!1,G.value=[],Y()}catch(e){console.error(e);let t=e?.response?.data?.message??e?.response?.data??`Save failed`;O.error(String(t))}finally{L.value=!1}},Oe=()=>{R.value=!1};function ke(e){return e.key===`edit`?`EditOutlined`:e.key===`delete`?`DeleteOutlined`:e.key===`planVersion`?`ProfileOutlined`:e.key===`pricingVersion`?`DatabaseOutlined`:`AppstoreOutlined`}function Ae(e,t){return typeof e.label==`function`?e.label(t):e.label}function je(e){return[{key:`edit`,label:`Edit`,type:`default`,permission:!0,enable:!0,onClick:Z},{key:`delete`,label:`Delete`,type:`danger`,permission:!0,enable:!0,onClick:Q}]}function Me(e,t){try{e.domEvent?.stopPropagation?.();let n=e.key;if(n===`edit`)return $(t,`__onEdit`);if(n===`delete`)return $(t,`__onDelete`)}catch(e){console.error(`onMenuClickWithRecord error`,e),O.error(`Action failed`)}}function $(e,t){try{let n=e?.[t];if(typeof n==`function`)return n(e);console.warn(`${t} is not a function on record`,e)}catch(e){console.error(`safeCall error`,e)}}return(r,i)=>{let s=te,d=n,y=ue,x=e,w=t,T=ne,O=re,A=oe,j=ae,M=ie,P=a,B=ee,V=o,H=se(`router-view`);return g(),c(H,null,{default:p(({route:e})=>[m(`div`,fe,[m(`h2`,pe,`Plan Versions for `+E(k(b)),1),l(A,{class:`mb16`,"body-style":{padding:`12px`}},{default:p(()=>[m(`div`,me,[l(s,{value:F.value,"onUpdate:value":i[0]||=e=>F.value=e,placeholder:`Search by PricingVersionId`,onSearch:X,style:{width:`360px`},allowClear:``},null,8,[`value`]),l(d,{type:`primary`,onClick:Te},{default:p(()=>[...i[8]||=[u(`Create Version`,-1)]]),_:1}),l(d,{danger:``,disabled:!G.value.length,onClick:Ee},{default:p(()=>[...i[9]||=[u(`Delete Selected`,-1)]]),_:1},8,[`disabled`]),l(d,{loading:I.value,onClick:Y},{default:p(()=>[...i[10]||=[u(`Refresh`,-1)]]),_:1},8,[`loading`]),l(d,{type:`default`,onClick:i[1]||=()=>k(v).push({name:`PricingVersions`,params:{planId:k(b)}})},{default:p(()=>[...i[11]||=[u(` Pricing Versions `,-1)]]),_:1})]),l(O,{columns:k(ve),dataSource:xe.value,loading:I.value,pagination:ye.value,rowKey:be,rowSelection:Se.value,scroll:{x:1e3},onChange:we},{bodyCell:p(({column:e,record:t})=>[e.key===`action`?(g(),c(T,{key:0,placement:`topLeft`,trigger:`click`},{overlay:p(()=>[l(w,{class:`menu-box`,onClick:i[2]||=()=>Me},{default:p(()=>[(g(!0),h(_,null,f(je(t),(e,n)=>(g(),c(x,{key:`${n}-${e.label}`,style:ce({color:e.type===`delete`?`red`:`inherit`})},{icon:p(()=>[l(y,{align:`2px`,size:`15px`,style:{"margin-right":`12px`},type:ke(e)},null,8,[`type`])]),default:p(()=>[e.permission===!1?(g(),h(`span`,he,`——`)):(g(),h(`a`,{key:1,onClick:()=>e.onClick?.(t),type:e.type},E(Ae(e,t)),9,ge))]),_:2},1032,[`style`]))),128))]),_:2},1024)]),default:p(()=>[m(`span`,{class:`ant-dropdown-link`,role:`button`,tabindex:`0`,onClick:i[3]||=le(()=>{},[`prevent`])},[l(y,{align:`2px`,size:`20px`,style:{"margin-left":`5px`},type:`EllipsisOutlined`})])]),_:2},1024)):(g(),h(`span`,_e,E(t[e.dataIndex]),1))]),_:1},8,[`columns`,`dataSource`,`loading`,`pagination`,`rowSelection`])]),_:1}),l(V,{open:R.value,"onUpdate:open":i[7]||=e=>R.value=e,title:z.value?`Edit Plan Version`:`Create Plan Version`,onOk:De,onCancel:Oe,confirmLoading:L.value,width:640,centered:``},{default:p(()=>[l(B,{ref_key:`formRef`,ref:J,model:q.value,rules:Ce,layout:`vertical`},{default:p(()=>[l(P,{label:`Pricing Version Id`,name:`pricingVersionId`,rules:z.value?[]:[{required:!0,message:`PricingVersionId required`}]},{default:p(()=>[l(M,{value:q.value.pricingVersionId,"onUpdate:value":i[4]||=e=>q.value.pricingVersionId=e,placeholder:`Select pricing version`,disabled:z.value,loading:C.value,showSearch:``,optionFilterProp:`label`,allowClear:``,onDropdownVisibleChange:D},{default:p(()=>[(g(!0),h(_,null,f(S.value,e=>(g(),c(j,{key:e.pricingVersionId,value:e.pricingVersionId},{default:p(()=>[u(E(e.pricingVersionId)+` - `+E(k(de)(e.effectiveFrom)),1)]),_:2},1032,[`value`]))),128))]),_:1},8,[`value`,`disabled`,`loading`])]),_:1},8,[`rules`]),l(P,{label:`Rounding Premium`,name:`roundingPremium`},{default:p(()=>[l(M,{value:q.value.roundingPremium,"onUpdate:value":i[5]||=e=>q.value.roundingPremium=e,placeholder:`Select rounding rule for premium`,allowClear:``},{default:p(()=>[(g(!0),h(_,null,f(N.value,e=>(g(),c(j,{key:e.value,value:e.value},{default:p(()=>[u(E(e.label),1)]),_:2},1032,[`value`]))),128))]),_:1},8,[`value`])]),_:1}),l(P,{label:`Rounding Cash Val`,name:`roundingCashVal`},{default:p(()=>[l(M,{value:q.value.roundingCashVal,"onUpdate:value":i[6]||=e=>q.value.roundingCashVal=e,placeholder:`Select rounding rule for cash value`,allowClear:``},{default:p(()=>[(g(!0),h(_,null,f(N.value,e=>(g(),c(j,{key:e.value,value:e.value},{default:p(()=>[u(E(e.label),1)]),_:2},1032,[`value`]))),128))]),_:1},8,[`value`])]),_:1})]),_:1},8,[`model`])]),_:1},8,[`open`,`title`,`confirmLoading`])])]),_:1})}}}),[[`__scopeId`,`data-v-5134830b`]]);export{F as default};