import{o as e,t}from"./menu-KmJeyBmp.js";import{n,t as r}from"./_plugin-vue_export-helper-DjLyun5i.js";import{a as i,i as a,l as o,o as ee,t as te}from"./input-Dl58X2zG.js";import{i as s,t as c}from"./table-B5NlV_bM.js";import{r as l,t as u}from"./select-qwNyy2X6.js";import{o as d}from"./Col-Dn_WxAuq.js";import"./FolderOutlined-CuOYp4hi.js";import"./EyeInvisibleOutlined-DQ7XOaOB.js";import{t as f}from"./modal-7zbmb4iA.js";import"./move-BV2dG8Yt.js";import"./checkbox-DTOnil2W.js";import"./dropdown-BjYLSNDe.js";import"./SwapRightOutlined-DC-xg5cP.js";import"./es-DfE0qcvE.js";import"./UpOutlined-CVKY-LmD.js";import"./spin-CjGf5sPd.js";import"./ArrowRightOutlined-jL2ruyWB.js";import{Cn as p,Dn as m,En as h,Fn as g,Gn as ne,Jn as re,Kn as ie,Qn as _,Sn as v,Tn as y,Un as b,_n as x,fr as S,hn as C,ir as w,jn as T,kn as E,ln as D,pr as O,u as k,ur as ae,xn as A}from"./index-DNW3ueIJ.js";import{t as oe}from"./Icon-LsJhdwkb.js";import{t as j}from"./productPlan-zKUpmInK.js";const M=[{title:`No`,dataIndex:`index`,key:`index`,width:80},{title:`Plan Id`,dataIndex:`planId`,key:`planId`,width:240,sorter:!1,sortDirections:[`ascend`,`descend`]},{title:`Product Type`,dataIndex:`productType`,key:`productType`,width:160,sorter:!1,sortDirections:[`ascend`,`descend`]},{title:`Name`,dataIndex:`name`,key:`name`,width:320,sorter:!1,sortDirections:[`ascend`,`descend`]},{title:`Currency`,dataIndex:`currency`,key:`currency`,width:120,sorter:!1,sortDirections:[`ascend`,`descend`],customRender:({text:e})=>T(`span`,e??`VND`)},{title:`Action`,key:`action`,fixed:`right`,width:160}];var se={key:1,class:`product-plan-page`},ce={style:{display:`flex`,gap:`12px`,"align-items":`center`,"margin-bottom":`8px`}},le={key:0},ue=[`onClick`,`type`],N={key:1},P=r(E({__name:`index`,setup(r){let T=D(),E=w(``),P=w(!1),F=w(!1),I=w(!1),L=w(!1),R=w(null),z=w(1),B=w(20),V=w(0),H=w([]),U=w([]),W={planId:``,productType:``,name:``,currency:`VND`},G=w({...W}),K=w(),de=M,fe=A(()=>({current:z.value,pageSize:B.value,total:V.value,showSizeChanger:!0,showQuickJumper:!0})),pe=e=>e.planId;function q(e){T.push({name:`ProductBenefits`,params:{planId:e.planId}})}function J(e){T.push({name:`PricingVersions`,params:{planId:e.planId}})}async function Y(e){await T.push({name:`PlanVersions`,params:{planId:e.planId}})}let me=A(()=>H.value.map((e,t)=>({...e,index:(z.value-1)*B.value+t+1,__onEdit:Q,__onDelete:$,__onManagerPlanVersion:Y,__onManagePricingVersions:J,__onManageProductBenefits:q}))),he={productType:[{required:!0,message:`ProductType required`,trigger:`blur`}],name:[{required:!0,message:`Name required`,trigger:`blur`}]},ge=A(()=>({selectedRowKeys:U.value,onChange:(e,t)=>{U.value=e.slice()}}));function _e(e){return e.key===`edit`?`EditOutlined`:e.key===`delete`?`DeleteOutlined`:e.key===`planVersion`?`ProfileOutlined`:e.key===`pricingVersion`?`DatabaseOutlined`:`AppstoreOutlined`}function ve(e,t){return typeof e.label==`function`?e.label(t):e.label}function ye(e){return[{key:`edit`,label:`Edit`,type:`default`,permission:!0,enable:!0,onClick:Q},{key:`delete`,label:`Delete`,type:`danger`,permission:!0,enable:!0,onClick:$},{key:`planVersion`,label:`Plan Version`,type:`default`,permission:!0,enable:!0,onClick:Y},{key:`pricingVersion`,label:`Pricing Version`,type:`default`,permission:!0,enable:!0,onClick:J},{key:`productBenefit`,label:`Product Benefit`,type:`default`,permission:!0,enable:!0,onClick:q}]}function be(e,t){try{e.domEvent?.stopPropagation?.();let n=e.key;if(n===`edit`)return X(t,`__onEdit`);if(n===`delete`)return X(t,`__onDelete`);if(n===`view`)return X(t,`__onView`)}catch(e){console.error(`onMenuClickWithRecord error`,e),k.error(`Action failed`)}}function X(e,t){try{let n=e?.[t];if(typeof n==`function`)return n(e);console.warn(`${t} is not a function on record`,e)}catch(e){console.error(`safeCall error`,e)}}let Z=async()=>{P.value=!0;try{let e={page:z.value,pageSize:B.value,q:E.value||void 0},t=await j.getAll(e),n=t.data??t;H.value=Array.from(n.items??n.items??[]),V.value=n.totalItems??n.totalItems??0}catch(e){console.error(e),k.error(`Load product plans failed`)}finally{P.value=!1}},xe=async()=>{z.value=1,await Z()},Se=async e=>{e&&(z.value=e.current||z.value,B.value=e.pageSize||B.value),await Z()},Ce=async()=>{L.value=!1,R.value=null,Object.assign(G.value,o(W)),I.value=!0,await g(),K.value?.resetFields?.(o(W)),K.value?.clearValidate?.(),await g()};async function Q(e){L.value=!0,R.value=e.planId;try{let t=await j.getDetail(e.planId),n=t.data??t;Object.assign(G.value,{planId:n.planId,productType:n.productType,name:n.name,currency:n.currency??`VND`}),I.value=!0,await g(),K.value?.clearValidate?.()}catch(e){console.error(e),k.error(`Load plan detail failed`)}}async function $(e){f.confirm({title:`Delete product plan`,content:`Delete plan ${e.planId}?`,onOk:async()=>{try{await j.remove(e.planId),k.success(`Deleted`),U.value=U.value.filter(t=>t!==e.planId),Z()}catch(e){console.error(e),k.error(`Delete failed`)}}})}let we=async()=>{U.value.length&&f.confirm({title:`Delete ${U.value.length} product plan(s)`,content:`Are you sure to delete selected plans?`,onOk:async()=>{try{for(let e of[...U.value])await j.remove(e);k.success(`Deleted selected plans`)}catch(e){console.error(e),k.error(`Delete failed`)}finally{U.value=[],z.value=1,Z()}}})},Te=async()=>{try{await K.value?.validate?.()}catch{return}let e={planId:(G.value.planId??``).trim(),productType:(G.value.productType??``).trim(),name:(G.value.name??``).trim(),currency:G.value.currency??`VND`},t={productType:(G.value.productType??``).trim(),name:(G.value.name??``).trim(),currency:G.value.currency??`VND`};F.value=!0;try{L.value&&R.value?(await j.update(R.value,t),k.success(`Updated`)):(await j.create(e),k.success(`Created`)),I.value=!1,U.value=[],Z()}catch(e){console.error(e);let t=e?.response?.data?.error??e?.response?.data??`Save failed`;k.error(String(t))}finally{F.value=!1}},Ee=()=>{I.value=!1};return Z(),(r,o)=>{let g=a,w=n,T=oe,D=e,k=t,A=s,j=c,M=d,R=te,z=ee,B=u,V=l,H=i,W=f,q=ie(`router-view`);return b(),p(q,null,{default:_(({Component:e})=>[e?(b(),p(re(e),{key:0})):(b(),y(`div`,se,[o[17]||=v(`h2`,{class:`title`},`Sản phẩm bảo hiểm`,-1),m(M,{class:`mb16`,"body-style":{padding:`12px`}},{default:_(()=>[v(`div`,ce,[m(g,{value:E.value,"onUpdate:value":o[0]||=e=>E.value=e,placeholder:`Search by PlanId or Name`,onSearch:xe,style:{width:`360px`},allowClear:``},null,8,[`value`]),m(w,{type:`primary`,onClick:Ce},{default:_(()=>[...o[8]||=[h(`Create Plan`,-1)]]),_:1}),m(w,{danger:``,disabled:!U.value.length,onClick:we},{default:_(()=>[...o[9]||=[h(`Delete Selected`,-1)]]),_:1},8,[`disabled`]),m(w,{loading:P.value,onClick:Z},{default:_(()=>[...o[10]||=[h(`Refresh`,-1)]]),_:1},8,[`loading`])]),m(j,{columns:ae(de),dataSource:me.value,loading:P.value,pagination:fe.value,rowKey:pe,rowSelection:ge.value,scroll:{x:1e3},onChange:Se},{bodyCell:_(({column:e,record:t})=>[e.key===`action`?(b(),p(A,{key:0,placement:`topLeft`,trigger:`click`},{overlay:_(()=>[m(k,{class:`menu-box`,onClick:o[1]||=()=>be},{default:_(()=>[(b(!0),y(x,null,ne(ye(t),(e,n)=>(b(),p(D,{key:`${n}-${e.label}`,style:S({color:e.type===`delete`?`red`:`inherit`})},{icon:_(()=>[m(T,{align:`2px`,size:`15px`,style:{"margin-right":`12px`},type:_e(e)},null,8,[`type`])]),default:_(()=>[e.permission===!1?(b(),y(`span`,le,`——`)):(b(),y(`a`,{key:1,onClick:()=>e.onClick?.(t),type:e.type},O(ve(e,t)),9,ue))]),_:2},1032,[`style`]))),128))]),_:2},1024)]),default:_(()=>[v(`span`,{class:`ant-dropdown-link`,role:`button`,tabindex:`0`,onClick:o[2]||=C(()=>{},[`prevent`])},[m(T,{align:`2px`,size:`20px`,style:{"margin-left":`5px`},type:`EllipsisOutlined`})])]),_:2},1024)):(b(),y(`span`,N,O(t[e.dataIndex]),1))]),_:1},8,[`columns`,`dataSource`,`loading`,`pagination`,`rowSelection`])]),_:1}),m(W,{open:I.value,"onUpdate:open":o[7]||=e=>I.value=e,title:L.value?`Edit Product Plan`:`Create Product Plan`,onOk:Te,onCancel:Ee,confirmLoading:F.value,width:680,centered:``},{default:_(()=>[m(H,{ref_key:`formRef`,ref:K,model:G.value,rules:he,layout:`vertical`},{default:_(()=>[m(z,{label:`Plan Id`,name:`planId`,rules:L.value?[]:[{required:!0,message:`PlanId is required`}]},{default:_(()=>[m(R,{value:G.value.planId,"onUpdate:value":o[3]||=e=>G.value.planId=e,disabled:L.value,placeholder:`e.g. MAPLIFE_TERM_20`},null,8,[`value`,`disabled`])]),_:1},8,[`rules`]),m(z,{label:`Product Type`,name:`productType`,rules:[{required:!0,message:`ProductType required`}]},{default:_(()=>[m(V,{value:G.value.productType,"onUpdate:value":o[4]||=e=>G.value.productType=e,style:{width:`100%`}},{default:_(()=>[m(B,{value:`TERM`},{default:_(()=>[...o[11]||=[h(`TERM LIFE`,-1)]]),_:1}),m(B,{value:`WHOLE_LIFE`},{default:_(()=>[...o[12]||=[h(`WHOLE_LIFE`,-1)]]),_:1}),m(B,{value:`UNIVER_LIFE`},{default:_(()=>[...o[13]||=[h(`UNIVER_LIFE`,-1)]]),_:1})]),_:1},8,[`value`])]),_:1}),m(z,{label:`Name`,name:`name`,rules:[{required:!0,message:`Name required`}]},{default:_(()=>[m(R,{value:G.value.name,"onUpdate:value":o[5]||=e=>G.value.name=e,placeholder:`Product name`},null,8,[`value`])]),_:1}),m(z,{label:`Currency`,name:`currency`},{default:_(()=>[m(V,{value:G.value.currency,"onUpdate:value":o[6]||=e=>G.value.currency=e,style:{width:`100%`}},{default:_(()=>[m(B,{value:`VND`},{default:_(()=>[...o[14]||=[h(`VND`,-1)]]),_:1}),m(B,{value:`USD`},{default:_(()=>[...o[15]||=[h(`USD`,-1)]]),_:1}),m(B,{value:`EUR`},{default:_(()=>[...o[16]||=[h(`EUR`,-1)]]),_:1})]),_:1},8,[`value`])]),_:1})]),_:1},8,[`model`])]),_:1},8,[`open`,`title`,`confirmLoading`])]))]),_:1})}}}),[[`__scopeId`,`data-v-c37f4a7c`]]);export{P as default};